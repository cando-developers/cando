template <typename HESSIAN>
void nonbond_dd_cutoff_gradient(double a, double b, double qq, double invdd, double r_switch, double r_switch2, double r_cut, double r_cut2, double inv_range, size_t i3x1, size_t i3x2, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  constexpr size_t PositionSize = 6;
  /* !BASE */
  double cse_p1002_t1_g28305;
  double cse_p1002_t1_g28321;
  double cse_p1002_t1_g28331;
  double cse_p1002_t2_g28306;
  double cse_p1002_t3_g28307;
  double cse_p1002_t5_g28309;
  double cse_p1002_t7_g28311;
  double cse_p1_t1_g1230;
  double cse_p1_t1_g1231;
  double cse_p1_t1_g1232;
  double cse_p1_t1_g1233;
  double cse_p1_t1_g1234;
  double cse_p1_t1_g1235;
  double cse_p1_t1_g1237;
  double cse_p1_t1_g1238;
  double cse_p1_t46_g1206;
  double cse_p1_t47_g1207;
  double cse_p1_t48_g1208;
  double cse_p1_t49_g1209;
  double cse_p1_t50_g1210;
  double cse_p1_t51_g1211;
  double cse_p1_t52_g1212;
  double cse_p1_t53_g1213;
  double cse_p1_t54_g1214;
  double cse_p1_t55_g1215;
  double cse_p1_t56_g1216;
  double cse_p1_t57_g1217;
  double cse_p2_t11_g1251;
  double cse_p2_t12_g1252;
  double cse_p2_t13_g1253;
  double cse_p2_t1_g1293;
  double cse_p2_t1_g1295;
  double cse_p2_t1_g1296;
  double cse_p2_t1_g1297;
  double cse_p2_t1_g1298;
  double cse_p2_t1_g1299;
  double cse_p2_t1_g1300;
  double cse_p2_t1_g1301;
  double cse_p2_t1_g1302;
  double cse_p2_t29_g1269;
  double cse_p2_t2_g1242;
  double cse_p2_t30_g1270;
  double cse_p2_t31_g1271;
  double cse_p2_t32_g1272;
  double cse_p2_t33_g1273;
  double cse_p2_t34_g1274;
  double cse_p2_t39_g1279;
  double cse_p2_t3_g1243;
  double cse_p2_t40_g1280;
  double cse_p2_t41_g1281;
  double cse_p2_t42_g1282;
  double cse_p2_t43_g1283;
  double cse_p2_t44_g1284;
  double cse_p2_t4_g1244;
  double cse_p3_t19_g1321;
  double cse_p3_t1_g1342;
  double cse_p3_t1_g1343;
  double cse_p3_t1_g1344;
  double cse_p3_t1_g1345;
  double cse_p3_t1_g1346;
  double cse_p3_t20_g1322;
  double cse_p3_t21_g1323;
  double cse_p3_t22_g1324;
  double cse_p3_t23_g1325;
  double cse_p3_t24_g1326;
  double cse_p3_t25_g1327;
  double cse_p3_t26_g1328;
  double cse_p3_t27_g1329;
  double cse_p3_t28_g1330;
  double cse_p3_t29_g1331;
  double cse_p3_t30_g1332;
  double cse_p3_t32_g1334;
  double cse_p3_t33_g1335;
  double cse_p3_t34_g1336;
  double cse_p3_t35_g1337;
  double cse_p3_t36_g1338;
  double cse_p3_t37_g1339;
  double cse_p3_t3_g1305;
  double cse_p3_t5_g1307;
  double cse_p4_t10_g1361;
  double cse_p4_t11_g1362;
  double cse_p4_t12_g1363;
  double cse_p4_t13_g1364;
  double cse_p4_t14_g1365;
  double cse_p4_t15_g1366;
  double cse_p4_t16_g1367;
  double cse_p4_t5_g1356;
  double cse_p4_t6_g1357;
  double cse_p4_t7_g1358;
  double cse_p4_t8_g1359;
  double cse_p4_t9_g1360;
  double cse_p50_t7_g2658;
  double cse_p53_t1_g2689;
  double cse_p53_t1_g2690;
  double cse_p53_t1_g2691;
  double cse_p53_t1_g2692;
  double de_base_dr;
  double de_dr;
  double drs;
  double ds_dr;
  double ds_dt;
  double dx;
  double dy;
  double dz;
  double energy;
  double e_base;
  double e_coul;
  double e_lj;
  double g_x1;
  double g_x2;
  double g_y1;
  double g_y2;
  double g_z1;
  double g_z2;
  double invr2;
  double invr3;
  double invr6;
  double r;
  double r2;
  double s;
  double t1;
  double t2;
  double t3;
  double t4;
  double t5;
  DOUBLE x1 = position[i3x1 + 0];
  DOUBLE y1 = position[i3x1 + 1];
  DOUBLE z1 = position[i3x1 + 2];
  DOUBLE x2 = position[i3x2 + 0];
  DOUBLE y2 = position[i3x2 + 1];
  DOUBLE z2 = position[i3x2 + 2];
  {
    /* !BASE */
    dx = (x1 + (-(x2)));
    dy = (y1 + (-(y2)));
    dz = (z1 + (-(z2)));
    r2 = ((dx * dx) + (dy * dy) + (dz * dz));
    if ((r2 < r_cut2)) {
      /* !CUT */
      cse_p50_t7_g2658 = pow(r2, -0.50000000000000000    );
      r = (cse_p50_t7_g2658 * r2);
      invr2 = (cse_p50_t7_g2658 * cse_p50_t7_g2658);
      invr3 = (cse_p50_t7_g2658 * invr2);
      cse_p3_t1_g1346 = (invr2 * invr2);
      invr6 = (cse_p3_t1_g1346 * invr2);
      cse_p2_t1_g1296 = (a * invr6);
      e_lj = ((cse_p2_t1_g1296 * invr6) + (-((b * invr6))));
      cse_p3_t1_g1345 = (invdd * qq);
      e_coul = (cse_p3_t1_g1345 * invr2);
      e_base = (e_coul + e_lj);
      de_base_dr = ((-2.0000000000000000     * cse_p3_t1_g1345 * invr3) + (cse_p50_t7_g2658 * invr6 * ((-12.000000000000000     * cse_p2_t1_g1296) + (6.0000000000000000     * b))));
      if ((r2 < r_switch2)) {
        /* !SWITCH */
        cse_p1002_t5_g28309 = (cse_p3_t1_g1346 * cse_p50_t7_g2658);
        cse_p1002_t1_g28321 = (cse_p50_t7_g2658 * pow(r2, -1));
        cse_p1002_t7_g28311 = pow(r2, -1);
        cse_p1002_t1_g28331 = (cse_p1002_t1_g28321 * cse_p3_t1_g1345 * cse_p50_t7_g2658);
        cse_p1002_t1_g28305 = (-2.0000000000000000     * cse_p1002_t1_g28331);
        cse_p1002_t2_g28306 = (2.0000000000000000     * cse_p1002_t1_g28331);
        cse_p1_t1_g1232 = (cse_p1002_t5_g28309 * cse_p1002_t7_g28311 * cse_p2_t1_g1296 * cse_p50_t7_g2658);
        cse_p53_t1_g2689 = (-12.000000000000000     * cse_p1_t1_g1232);
        cse_p2_t2_g1242 = (cse_p53_t1_g2689 * dx);
        cse_p2_t3_g1243 = (cse_p53_t1_g2689 * dy);
        cse_p2_t4_g1244 = (cse_p53_t1_g2689 * dz);
        cse_p53_t1_g2691 = (12.000000000000000     * cse_p1_t1_g1232);
        cse_p2_t11_g1251 = (cse_p53_t1_g2691 * dx);
        cse_p2_t12_g1252 = (cse_p53_t1_g2691 * dy);
        cse_p2_t13_g1253 = (cse_p53_t1_g2691 * dz);
        cse_p3_t19_g1321 = (cse_p1002_t1_g28305 * dx);
        cse_p3_t20_g1322 = (cse_p1002_t1_g28305 * dy);
        cse_p3_t21_g1323 = (cse_p1002_t1_g28305 * dz);
        cse_p2_t1_g1293 = (cse_p1002_t1_g28321 * cse_p1002_t5_g28309);
        cse_p1002_t3_g28307 = (b * cse_p2_t1_g1293);
        cse_p3_t3_g1305 = (-6.0000000000000000     * cse_p1002_t3_g28307);
        cse_p3_t5_g1307 = (6.0000000000000000     * cse_p1002_t3_g28307);
        cse_p3_t22_g1324 = (cse_p3_t3_g1305 * dx);
        cse_p3_t23_g1325 = (cse_p3_t3_g1305 * dy);
        cse_p3_t24_g1326 = (cse_p3_t3_g1305 * dz);
        cse_p3_t25_g1327 = (cse_p1002_t2_g28306 * dx);
        cse_p3_t26_g1328 = (cse_p1002_t2_g28306 * dy);
        cse_p3_t27_g1329 = (cse_p1002_t2_g28306 * dz);
        cse_p3_t28_g1330 = (cse_p3_t5_g1307 * dx);
        cse_p3_t29_g1331 = (cse_p3_t5_g1307 * dy);
        cse_p3_t30_g1332 = (cse_p3_t5_g1307 * dz);
        cse_p1_t46_g1206 = (cse_p2_t2_g1242 + cse_p3_t19_g1321 + cse_p3_t28_g1330);
        cse_p1_t47_g1207 = (cse_p2_t3_g1243 + cse_p3_t20_g1322 + cse_p3_t29_g1331);
        cse_p1_t48_g1208 = (cse_p2_t4_g1244 + cse_p3_t21_g1323 + cse_p3_t30_g1332);
        cse_p1_t49_g1209 = (cse_p2_t11_g1251 + cse_p3_t22_g1324 + cse_p3_t25_g1327);
        cse_p1_t50_g1210 = (cse_p2_t12_g1252 + cse_p3_t23_g1325 + cse_p3_t26_g1328);
        cse_p1_t51_g1211 = (cse_p2_t13_g1253 + cse_p3_t24_g1326 + cse_p3_t27_g1329);
        energy = e_base;
        *energy_accumulate += energy;
        g_x1 = cse_p1_t46_g1206;
        KernelGradientAcc(i3x1, 0, g_x1);
        g_y1 = cse_p1_t47_g1207;
        KernelGradientAcc(i3x1, 1, g_y1);
        g_z1 = cse_p1_t48_g1208;
        KernelGradientAcc(i3x1, 2, g_z1);
        g_x2 = cse_p1_t49_g1209;
        KernelGradientAcc(i3x2, 0, g_x2);
        g_y2 = cse_p1_t50_g1210;
        KernelGradientAcc(i3x2, 1, g_y2);
        g_z2 = cse_p1_t51_g1211;
        KernelGradientAcc(i3x2, 2, g_z2);
        de_dr = de_base_dr;
      } else {
        /* !SKIN */
        cse_p1002_t1_g28321 = (cse_p50_t7_g2658 * pow(r2, -1));
        cse_p1_t1_g1231 = (cse_p1002_t1_g28321 * r2);
        cse_p1_t1_g1234 = (-(cse_p1_t1_g1231));
        cse_p4_t5_g1356 = (cse_p1_t1_g1234 * dx);
        cse_p4_t6_g1357 = (cse_p1_t1_g1234 * dy);
        cse_p4_t7_g1358 = (cse_p1_t1_g1234 * dz);
        cse_p1_t1_g1235 = (-2.0000000000000000     * cse_p50_t7_g2658);
        cse_p4_t8_g1359 = (cse_p1_t1_g1235 * dx);
        cse_p4_t9_g1360 = (cse_p1_t1_g1235 * dy);
        cse_p4_t10_g1361 = (cse_p1_t1_g1235 * dz);
        cse_p4_t11_g1362 = (cse_p1_t1_g1231 * dx);
        cse_p4_t12_g1363 = (cse_p1_t1_g1231 * dy);
        cse_p4_t13_g1364 = (cse_p1_t1_g1231 * dz);
        cse_p3_t35_g1337 = (cse_p4_t11_g1362 + cse_p4_t8_g1359);
        cse_p3_t36_g1338 = (cse_p4_t12_g1363 + cse_p4_t9_g1360);
        cse_p3_t37_g1339 = (cse_p4_t10_g1361 + cse_p4_t13_g1364);
        cse_p1_t1_g1238 = (2.0000000000000000     * cse_p50_t7_g2658);
        cse_p4_t14_g1365 = (cse_p1_t1_g1238 * dx);
        cse_p4_t15_g1366 = (cse_p1_t1_g1238 * dy);
        cse_p4_t16_g1367 = (cse_p1_t1_g1238 * dz);
        cse_p3_t32_g1334 = (cse_p4_t14_g1365 + cse_p4_t5_g1356);
        cse_p3_t33_g1335 = (cse_p4_t15_g1366 + cse_p4_t6_g1357);
        cse_p3_t34_g1336 = (cse_p4_t16_g1367 + cse_p4_t7_g1358);
        drs = (r + (-(r_switch)));
        t1 = (drs * inv_range);
        cse_p1_t1_g1233 = (inv_range * t1);
        cse_p1_t1_g1237 = (2.0000000000000000     * cse_p1_t1_g1233);
        cse_p2_t1_g1302 = (cse_p1_t1_g1237 * t1);
        cse_p2_t29_g1269 = (cse_p2_t1_g1302 * cse_p3_t32_g1334);
        cse_p2_t30_g1270 = (cse_p2_t1_g1302 * cse_p3_t33_g1335);
        cse_p2_t31_g1271 = (cse_p2_t1_g1302 * cse_p3_t34_g1336);
        cse_p2_t32_g1272 = (cse_p2_t1_g1302 * cse_p3_t35_g1337);
        cse_p2_t33_g1273 = (cse_p2_t1_g1302 * cse_p3_t36_g1338);
        cse_p2_t34_g1274 = (cse_p2_t1_g1302 * cse_p3_t37_g1339);
        t2 = (t1 * t1);
        cse_p3_t1_g1344 = (inv_range * t2);
        cse_p2_t39_g1279 = (cse_p3_t1_g1344 * cse_p3_t32_g1334);
        cse_p2_t40_g1280 = (cse_p3_t1_g1344 * cse_p3_t33_g1335);
        cse_p2_t41_g1281 = (cse_p3_t1_g1344 * cse_p3_t34_g1336);
        cse_p2_t42_g1282 = (cse_p3_t1_g1344 * cse_p3_t35_g1337);
        cse_p2_t43_g1283 = (cse_p3_t1_g1344 * cse_p3_t36_g1338);
        cse_p2_t44_g1284 = (cse_p3_t1_g1344 * cse_p3_t37_g1339);
        cse_p1_t52_g1212 = (cse_p2_t29_g1269 + cse_p2_t39_g1279);
        cse_p1_t53_g1213 = (cse_p2_t30_g1270 + cse_p2_t40_g1280);
        cse_p1_t54_g1214 = (cse_p2_t31_g1271 + cse_p2_t41_g1281);
        cse_p1_t55_g1215 = (cse_p2_t32_g1272 + cse_p2_t42_g1282);
        cse_p1_t56_g1216 = (cse_p2_t33_g1273 + cse_p2_t43_g1283);
        cse_p1_t57_g1217 = (cse_p2_t34_g1274 + cse_p2_t44_g1284);
        t3 = (t1 * t2);
        t4 = (t2 * t2);
        t5 = (t2 * t3);
        s = (1.0000000000000000     + (-10.000000000000000     * t3) + (-6.0000000000000000     * t5) + (15.000000000000000     * t4));
        ds_dt = ((-30.000000000000000     * t2) + (-30.000000000000000     * t4) + (60.000000000000000     * t3));
        ds_dr = (ds_dt * inv_range);
        energy = (e_base * s);
        *energy_accumulate += energy;
        cse_p1_t1_g1230 = (cse_p3_t1_g1346 * cse_p50_t7_g2658);
        cse_p2_t1_g1293 = (cse_p1002_t1_g28321 * cse_p1_t1_g1230);
        cse_p1002_t1_g28331 = (cse_p1002_t1_g28321 * cse_p3_t1_g1345 * cse_p50_t7_g2658);
        cse_p2_t1_g1295 = (b * cse_p2_t1_g1293);
        cse_p2_t1_g1297 = (60.000000000000000     * cse_p1_t1_g1233 * t2);
        cse_p2_t1_g1298 = (-2.0000000000000000     * cse_p1002_t1_g28331);
        cse_p2_t1_g1301 = (6.0000000000000000     * cse_p2_t1_g1295);
        cse_p3_t1_g1342 = (cse_p1_t1_g1237 * t3);
        cse_p3_t1_g1343 = (cse_p2_t1_g1293 * cse_p2_t1_g1296);
        cse_p53_t1_g2690 = (-12.000000000000000     * cse_p3_t1_g1343);
        g_x1 = ((e_base * ((-10.000000000000000     * cse_p1_t52_g1212) + (-6.0000000000000000     * ((cse_p1_t52_g1212 * t2) + (cse_p3_t1_g1342 * cse_p3_t32_g1334))) + (cse_p2_t1_g1297 * cse_p3_t32_g1334))) + (s * ((cse_p2_t1_g1298 * dx) + (cse_p2_t1_g1301 * dx) + (cse_p53_t1_g2690 * dx))));
        KernelGradientAcc(i3x1, 0, g_x1);
        g_y1 = ((e_base * ((-10.000000000000000     * cse_p1_t53_g1213) + (-6.0000000000000000     * ((cse_p1_t53_g1213 * t2) + (cse_p3_t1_g1342 * cse_p3_t33_g1335))) + (cse_p2_t1_g1297 * cse_p3_t33_g1335))) + (s * ((cse_p2_t1_g1298 * dy) + (cse_p2_t1_g1301 * dy) + (cse_p53_t1_g2690 * dy))));
        KernelGradientAcc(i3x1, 1, g_y1);
        g_z1 = ((e_base * ((-10.000000000000000     * cse_p1_t54_g1214) + (-6.0000000000000000     * ((cse_p1_t54_g1214 * t2) + (cse_p3_t1_g1342 * cse_p3_t34_g1336))) + (cse_p2_t1_g1297 * cse_p3_t34_g1336))) + (s * ((cse_p2_t1_g1298 * dz) + (cse_p2_t1_g1301 * dz) + (cse_p53_t1_g2690 * dz))));
        KernelGradientAcc(i3x1, 2, g_z1);
        cse_p2_t1_g1299 = (-6.0000000000000000     * cse_p2_t1_g1295);
        cse_p2_t1_g1300 = (2.0000000000000000     * cse_p1002_t1_g28331);
        cse_p53_t1_g2692 = (12.000000000000000     * cse_p3_t1_g1343);
        g_x2 = ((e_base * ((-10.000000000000000     * cse_p1_t55_g1215) + (-6.0000000000000000     * ((cse_p1_t55_g1215 * t2) + (cse_p3_t1_g1342 * cse_p3_t35_g1337))) + (cse_p2_t1_g1297 * cse_p3_t35_g1337))) + (s * ((cse_p2_t1_g1299 * dx) + (cse_p2_t1_g1300 * dx) + (cse_p53_t1_g2692 * dx))));
        KernelGradientAcc(i3x2, 0, g_x2);
        g_y2 = ((e_base * ((-10.000000000000000     * cse_p1_t56_g1216) + (-6.0000000000000000     * ((cse_p1_t56_g1216 * t2) + (cse_p3_t1_g1342 * cse_p3_t36_g1338))) + (cse_p2_t1_g1297 * cse_p3_t36_g1338))) + (s * ((cse_p2_t1_g1299 * dy) + (cse_p2_t1_g1300 * dy) + (cse_p53_t1_g2692 * dy))));
        KernelGradientAcc(i3x2, 1, g_y2);
        g_z2 = ((e_base * ((-10.000000000000000     * cse_p1_t57_g1217) + (-6.0000000000000000     * ((cse_p1_t57_g1217 * t2) + (cse_p3_t1_g1342 * cse_p3_t37_g1339))) + (cse_p2_t1_g1297 * cse_p3_t37_g1339))) + (s * ((cse_p2_t1_g1299 * dz) + (cse_p2_t1_g1300 * dz) + (cse_p53_t1_g2692 * dz))));
        KernelGradientAcc(i3x2, 2, g_z2);
        de_dr = ((de_base_dr * s) + (ds_dr * e_base));
      }
    }
  }
}
template <typename HESSIAN>
void nonbond_dd_cutoff_gradient_fd(double a, double b, double qq, double invdd, double r_switch, double r_switch2, double r_cut, double r_cut2, double inv_range, size_t i3x1, size_t i3x2, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  constexpr size_t PositionSize = 6;
  const double h = 1.0e-5;
  const double inv2h = 1.0/(2.0*h);
  double e0 = 0.0;
  nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e0, 0, 0, 0, 0);
  if (energy_accumulate) { *energy_accumulate += e0; }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 0, d);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 1, d);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 2, d);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 0, d);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 1, d);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    nonbond_dd_cutoff_energy(a, b, qq, invdd, r_switch, r_switch2, r_cut, r_cut2, inv_range, i3x1, i3x2, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 2, d);
  }
}

