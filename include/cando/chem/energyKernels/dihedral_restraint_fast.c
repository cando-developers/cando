template <typename HESSIAN>
struct Dihedral_Restraint_Fast {
  static constexpr size_t PositionSize = 12;
  static std::string description() { return "mathkernel-dihedral_restraint_fast"; };
double energy(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  double cosphi;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double energy_added;
  double inv_n1n2;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  energy_added = 0.0000000000000000    ;
  {
    /* !BASE */
    DOUBLE x1 = position[i3x1 + 0];
    DOUBLE y1 = position[i3x1 + 1];
    DOUBLE z1 = position[i3x1 + 2];
    DOUBLE x2 = position[i3x2 + 0];
    DOUBLE y2 = position[i3x2 + 1];
    DOUBLE z2 = position[i3x2 + 2];
    DOUBLE x3 = position[i3x3 + 0];
    DOUBLE y3 = position[i3x3 + 1];
    DOUBLE z3 = position[i3x3 + 2];
    DOUBLE x4 = position[i3x4 + 0];
    DOUBLE y4 = position[i3x4 + 1];
    DOUBLE z4 = position[i3x4 + 2];
    {
      /* !BASE */
      dx12 = (x2 + (-(x1)));
      dy12 = (y2 + (-(y1)));
      dz12 = (z2 + (-(z1)));
      dx23 = (x3 + (-(x2)));
      dy23 = (y3 + (-(y2)));
      dz23 = (z3 + (-(z2)));
      dx34 = (x4 + (-(x3)));
      dy34 = (y4 + (-(y3)));
      dz34 = (z4 + (-(z3)));
      n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
      n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
      n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
      n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
      n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
      n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
      n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
      n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
      inv_n1n2 = (1.0 / sqrt((n1_2 * n2_2)));
      dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
      cosphi = (dot_n1n2 * inv_n1n2);
      phi = acos(cosphi);
      deltaphi = (phi + (-(phi0)));
      energy = (deltaphi * deltaphi * kdh);
      energy_added += energy;
      *energy_accumulate += energy;
    }
  }
  return energy_added;
}
void energy_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, energy_accumulate, force, hessian, dvec, hdvec);
}

double gradient(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  double cosphi;
  double cse_p12_t10_g51374;
  double cse_p12_t11_g51375;
  double cse_p12_t12_g51376;
  double cse_p12_t13_g51377;
  double cse_p12_t14_g51378;
  double cse_p12_t15_g51379;
  double cse_p12_t16_g51380;
  double cse_p12_t17_g51381;
  double cse_p12_t18_g51382;
  double cse_p12_t19_g51383;
  double cse_p12_t1_g51365;
  double cse_p12_t1_g51413;
  double cse_p12_t1_g51414;
  double cse_p12_t1_g51415;
  double cse_p12_t1_g51416;
  double cse_p12_t20_g51384;
  double cse_p12_t21_g51385;
  double cse_p12_t22_g51386;
  double cse_p12_t23_g51387;
  double cse_p12_t24_g51388;
  double cse_p12_t25_g51389;
  double cse_p12_t26_g51390;
  double cse_p12_t27_g51391;
  double cse_p12_t28_g51392;
  double cse_p12_t29_g51393;
  double cse_p12_t2_g51366;
  double cse_p12_t30_g51394;
  double cse_p12_t31_g51395;
  double cse_p12_t32_g51396;
  double cse_p12_t33_g51397;
  double cse_p12_t34_g51398;
  double cse_p12_t35_g51399;
  double cse_p12_t36_g51400;
  double cse_p12_t37_g51401;
  double cse_p12_t38_g51402;
  double cse_p12_t39_g51403;
  double cse_p12_t3_g51367;
  double cse_p12_t40_g51404;
  double cse_p12_t41_g51405;
  double cse_p12_t42_g51406;
  double cse_p12_t43_g51407;
  double cse_p12_t44_g51408;
  double cse_p12_t45_g51409;
  double cse_p12_t46_g51410;
  double cse_p12_t47_g51411;
  double cse_p12_t48_g51412;
  double cse_p12_t4_g51368;
  double cse_p12_t5_g51369;
  double cse_p12_t6_g51370;
  double cse_p12_t7_g51371;
  double cse_p12_t8_g51372;
  double cse_p12_t9_g51373;
  double cse_p1_t1_invsqrt51362;
  double cse_p1_t2_invr51363;
  double cse_p1_t3_invsqrt51364;
  double cse_p21_t1_g51417;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double energy_added;
  double g_x1;
  double g_x2;
  double g_x3;
  double g_x4;
  double g_y1;
  double g_y2;
  double g_y3;
  double g_y4;
  double g_z1;
  double g_z2;
  double g_z3;
  double g_z4;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  energy_added = 0.0000000000000000    ;
  {
    /* !BASE */
    DOUBLE x1 = position[i3x1 + 0];
    DOUBLE y1 = position[i3x1 + 1];
    DOUBLE z1 = position[i3x1 + 2];
    DOUBLE x2 = position[i3x2 + 0];
    DOUBLE y2 = position[i3x2 + 1];
    DOUBLE z2 = position[i3x2 + 2];
    DOUBLE x3 = position[i3x3 + 0];
    DOUBLE y3 = position[i3x3 + 1];
    DOUBLE z3 = position[i3x3 + 2];
    DOUBLE x4 = position[i3x4 + 0];
    DOUBLE y4 = position[i3x4 + 1];
    DOUBLE z4 = position[i3x4 + 2];
    {
      /* !BASE */
      dx12 = (x2 + (-(x1)));
      dy12 = (y2 + (-(y1)));
      dz12 = (z2 + (-(z1)));
      dx23 = (x3 + (-(x2)));
      cse_p12_t37_g51401 = ((-(dx12)) + (-(dx23)));
      cse_p12_t43_g51407 = (dx12 + dx23);
      dy23 = (y3 + (-(y2)));
      cse_p12_t39_g51403 = ((-(dy12)) + (-(dy23)));
      cse_p12_t45_g51409 = (dy12 + dy23);
      dz23 = (z3 + (-(z2)));
      cse_p12_t41_g51405 = ((-(dz12)) + (-(dz23)));
      cse_p12_t47_g51411 = (dz12 + dz23);
      dx34 = (x4 + (-(x3)));
      cse_p12_t38_g51402 = ((-(dx23)) + (-(dx34)));
      cse_p12_t44_g51408 = (dx23 + dx34);
      dy34 = (y4 + (-(y3)));
      cse_p12_t40_g51404 = ((-(dy23)) + (-(dy34)));
      cse_p12_t46_g51410 = (dy23 + dy34);
      dz34 = (z4 + (-(z3)));
      cse_p12_t42_g51406 = ((-(dz23)) + (-(dz34)));
      cse_p12_t48_g51412 = (dz23 + dz34);
      n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
      cse_p12_t5_g51369 = (dy12 * n1x);
      cse_p12_t6_g51370 = (dy23 * n1x);
      cse_p12_t13_g51377 = (cse_p12_t39_g51403 * n1x);
      cse_p12_t14_g51378 = (cse_p12_t47_g51411 * n1x);
      cse_p12_t15_g51379 = (n1x * (-(dz12)));
      cse_p12_t16_g51380 = (n1x * (-(dz23)));
      n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
      cse_p12_t9_g51373 = (dz12 * n1y);
      cse_p12_t10_g51374 = (dz23 * n1y);
      cse_p12_t17_g51381 = (cse_p12_t41_g51405 * n1y);
      cse_p12_t18_g51382 = (cse_p12_t43_g51407 * n1y);
      cse_p12_t19_g51383 = (n1y * (-(dx12)));
      cse_p12_t20_g51384 = (n1y * (-(dx23)));
      n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
      cse_p12_t1_g51365 = (dx12 * n1z);
      cse_p12_t2_g51366 = (dx23 * n1z);
      cse_p12_t21_g51385 = (cse_p12_t37_g51401 * n1z);
      cse_p12_t22_g51386 = (cse_p12_t45_g51409 * n1z);
      cse_p12_t23_g51387 = (n1z * (-(dy12)));
      cse_p12_t24_g51388 = (n1z * (-(dy23)));
      n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
      cse_p12_t7_g51371 = (dy23 * n2x);
      cse_p12_t8_g51372 = (dy34 * n2x);
      cse_p12_t25_g51389 = (cse_p12_t40_g51404 * n2x);
      cse_p12_t26_g51390 = (cse_p12_t48_g51412 * n2x);
      cse_p12_t27_g51391 = (n2x * (-(dz23)));
      cse_p12_t28_g51392 = (n2x * (-(dz34)));
      n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
      cse_p12_t11_g51375 = (dz23 * n2y);
      cse_p12_t12_g51376 = (dz34 * n2y);
      cse_p12_t29_g51393 = (cse_p12_t42_g51406 * n2y);
      cse_p12_t30_g51394 = (cse_p12_t44_g51408 * n2y);
      cse_p12_t31_g51395 = (n2y * (-(dx23)));
      cse_p12_t32_g51396 = (n2y * (-(dx34)));
      n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
      cse_p12_t3_g51367 = (dx23 * n2z);
      cse_p12_t4_g51368 = (dx34 * n2z);
      cse_p12_t33_g51397 = (cse_p12_t38_g51402 * n2z);
      cse_p12_t34_g51398 = (cse_p12_t46_g51410 * n2z);
      cse_p12_t35_g51399 = (n2z * (-(dy23)));
      cse_p12_t36_g51400 = (n2z * (-(dy34)));
      n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
      n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
      cse_p1_t1_invsqrt51362 = (1.0 / sqrt((n1_2 * n2_2)));
      cse_p1_t2_invr51363 = (cse_p1_t1_invsqrt51362 * cse_p1_t1_invsqrt51362);
      dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
      cosphi = (cse_p1_t1_invsqrt51362 * dot_n1n2);
      phi = acos(cosphi);
      deltaphi = (phi + (-(phi0)));
      cse_p12_t1_g51414 = (deltaphi * kdh);
      energy = (cse_p12_t1_g51414 * deltaphi);
      energy_added += energy;
      *energy_accumulate += energy;
      cse_p1_t3_invsqrt51364 = (1.0 / sqrt((1.0000000000000000     + (-(((cosphi) * (cosphi)))))));
      cse_p12_t1_g51413 = (-0.50000000000000000     * cse_p1_t1_invsqrt51362 * cse_p1_t2_invr51363 * dot_n1n2);
      cse_p12_t1_g51416 = (cse_p12_t1_g51413 * n2_2);
      cse_p21_t1_g51417 = (cse_p12_t1_g51414 * cse_p1_t3_invsqrt51364);
      g_x1 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t10_g51374 + cse_p12_t10_g51374 + cse_p12_t24_g51388 + cse_p12_t24_g51388)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t11_g51375 + cse_p12_t35_g51399)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t10_g51374 + cse_p12_t10_g51374 + cse_p12_t24_g51388 + cse_p12_t24_g51388)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t11_g51375 + cse_p12_t35_g51399)))))));
      KernelGradientAcc(i3x1, 0, g_x1);
      g_y1 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t16_g51380 + cse_p12_t16_g51380 + cse_p12_t2_g51366 + cse_p12_t2_g51366)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t27_g51391 + cse_p12_t3_g51367)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t16_g51380 + cse_p12_t16_g51380 + cse_p12_t2_g51366 + cse_p12_t2_g51366)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t27_g51391 + cse_p12_t3_g51367)))))));
      KernelGradientAcc(i3x1, 1, g_y1);
      g_z1 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t20_g51384 + cse_p12_t20_g51384 + cse_p12_t6_g51370 + cse_p12_t6_g51370)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t31_g51395 + cse_p12_t7_g51371)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51416 * (cse_p12_t20_g51384 + cse_p12_t20_g51384 + cse_p12_t6_g51370 + cse_p12_t6_g51370)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t31_g51395 + cse_p12_t7_g51371)))))));
      KernelGradientAcc(i3x1, 2, g_z1);
      g_x2 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t12_g51376 + cse_p12_t12_g51376 + cse_p12_t36_g51400 + cse_p12_t36_g51400)) + (n2_2 * (cse_p12_t17_g51381 + cse_p12_t17_g51381 + cse_p12_t22_g51386 + cse_p12_t22_g51386)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t41_g51405 * n2y) + (cse_p12_t45_g51409 * n2z) + (dz34 * n1y) + (n1z * (-(dy34))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t12_g51376 + cse_p12_t12_g51376 + cse_p12_t36_g51400 + cse_p12_t36_g51400)) + (n2_2 * (cse_p12_t17_g51381 + cse_p12_t17_g51381 + cse_p12_t22_g51386 + cse_p12_t22_g51386)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t41_g51405 * n2y) + (cse_p12_t45_g51409 * n2z) + (dz34 * n1y) + (n1z * (-(dy34))))))))));
      KernelGradientAcc(i3x2, 0, g_x2);
      g_y2 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t28_g51392 + cse_p12_t28_g51392 + cse_p12_t4_g51368 + cse_p12_t4_g51368)) + (n2_2 * (cse_p12_t14_g51378 + cse_p12_t14_g51378 + cse_p12_t21_g51385 + cse_p12_t21_g51385)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t37_g51401 * n2z) + (cse_p12_t47_g51411 * n2x) + (dx34 * n1z) + (n1x * (-(dz34))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t28_g51392 + cse_p12_t28_g51392 + cse_p12_t4_g51368 + cse_p12_t4_g51368)) + (n2_2 * (cse_p12_t14_g51378 + cse_p12_t14_g51378 + cse_p12_t21_g51385 + cse_p12_t21_g51385)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t37_g51401 * n2z) + (cse_p12_t47_g51411 * n2x) + (dx34 * n1z) + (n1x * (-(dz34))))))))));
      KernelGradientAcc(i3x2, 1, g_y2);
      g_z2 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t32_g51396 + cse_p12_t32_g51396 + cse_p12_t8_g51372 + cse_p12_t8_g51372)) + (n2_2 * (cse_p12_t13_g51377 + cse_p12_t13_g51377 + cse_p12_t18_g51382 + cse_p12_t18_g51382)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t39_g51403 * n2x) + (cse_p12_t43_g51407 * n2y) + (dy34 * n1x) + (n1y * (-(dx34))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t32_g51396 + cse_p12_t32_g51396 + cse_p12_t8_g51372 + cse_p12_t8_g51372)) + (n2_2 * (cse_p12_t13_g51377 + cse_p12_t13_g51377 + cse_p12_t18_g51382 + cse_p12_t18_g51382)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t39_g51403 * n2x) + (cse_p12_t43_g51407 * n2y) + (dy34 * n1x) + (n1y * (-(dx34))))))))));
      KernelGradientAcc(i3x2, 2, g_z2);
      g_x3 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t29_g51393 + cse_p12_t29_g51393 + cse_p12_t34_g51398 + cse_p12_t34_g51398)) + (n2_2 * (cse_p12_t23_g51387 + cse_p12_t23_g51387 + cse_p12_t9_g51373 + cse_p12_t9_g51373)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t42_g51406 * n1y) + (cse_p12_t46_g51410 * n1z) + (dz12 * n2y) + (n2z * (-(dy12))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t29_g51393 + cse_p12_t29_g51393 + cse_p12_t34_g51398 + cse_p12_t34_g51398)) + (n2_2 * (cse_p12_t23_g51387 + cse_p12_t23_g51387 + cse_p12_t9_g51373 + cse_p12_t9_g51373)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t42_g51406 * n1y) + (cse_p12_t46_g51410 * n1z) + (dz12 * n2y) + (n2z * (-(dy12))))))))));
      KernelGradientAcc(i3x3, 0, g_x3);
      g_y3 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t26_g51390 + cse_p12_t26_g51390 + cse_p12_t33_g51397 + cse_p12_t33_g51397)) + (n2_2 * (cse_p12_t15_g51379 + cse_p12_t15_g51379 + cse_p12_t1_g51365 + cse_p12_t1_g51365)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t38_g51402 * n1z) + (cse_p12_t48_g51412 * n1x) + (dx12 * n2z) + (n2x * (-(dz12))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t26_g51390 + cse_p12_t26_g51390 + cse_p12_t33_g51397 + cse_p12_t33_g51397)) + (n2_2 * (cse_p12_t15_g51379 + cse_p12_t15_g51379 + cse_p12_t1_g51365 + cse_p12_t1_g51365)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t38_g51402 * n1z) + (cse_p12_t48_g51412 * n1x) + (dx12 * n2z) + (n2x * (-(dz12))))))))));
      KernelGradientAcc(i3x3, 1, g_y3);
      g_z3 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t25_g51389 + cse_p12_t25_g51389 + cse_p12_t30_g51394 + cse_p12_t30_g51394)) + (n2_2 * (cse_p12_t19_g51383 + cse_p12_t19_g51383 + cse_p12_t5_g51369 + cse_p12_t5_g51369)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t40_g51404 * n1x) + (cse_p12_t44_g51408 * n1y) + (dy12 * n2x) + (n2y * (-(dx12))))))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51413 * ((n1_2 * (cse_p12_t25_g51389 + cse_p12_t25_g51389 + cse_p12_t30_g51394 + cse_p12_t30_g51394)) + (n2_2 * (cse_p12_t19_g51383 + cse_p12_t19_g51383 + cse_p12_t5_g51369 + cse_p12_t5_g51369)))) + (cse_p1_t1_invsqrt51362 * ((cse_p12_t40_g51404 * n1x) + (cse_p12_t44_g51408 * n1y) + (dy12 * n2x) + (n2y * (-(dx12))))))))));
      KernelGradientAcc(i3x3, 2, g_z3);
      cse_p12_t1_g51415 = (cse_p12_t1_g51413 * n1_2);
      g_x4 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t11_g51375 + cse_p12_t11_g51375 + cse_p12_t35_g51399 + cse_p12_t35_g51399)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t10_g51374 + cse_p12_t24_g51388)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t11_g51375 + cse_p12_t11_g51375 + cse_p12_t35_g51399 + cse_p12_t35_g51399)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t10_g51374 + cse_p12_t24_g51388)))))));
      KernelGradientAcc(i3x4, 0, g_x4);
      g_y4 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t27_g51391 + cse_p12_t27_g51391 + cse_p12_t3_g51367 + cse_p12_t3_g51367)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t16_g51380 + cse_p12_t2_g51366)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t27_g51391 + cse_p12_t27_g51391 + cse_p12_t3_g51367 + cse_p12_t3_g51367)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t16_g51380 + cse_p12_t2_g51366)))))));
      KernelGradientAcc(i3x4, 1, g_y4);
      g_z4 = ((-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t31_g51395 + cse_p12_t31_g51395 + cse_p12_t7_g51371 + cse_p12_t7_g51371)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t20_g51384 + cse_p12_t6_g51370)))))) + (-((cse_p21_t1_g51417 * ((cse_p12_t1_g51415 * (cse_p12_t31_g51395 + cse_p12_t31_g51395 + cse_p12_t7_g51371 + cse_p12_t7_g51371)) + (cse_p1_t1_invsqrt51362 * (cse_p12_t20_g51384 + cse_p12_t6_g51370)))))));
      KernelGradientAcc(i3x4, 2, g_z4);
    }
  }
  return energy_added;
}
void gradient_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  constexpr size_t PositionSize = 12;
  const double h = 1.0e-5;
  const double inv2h = 1.0/(2.0*h);
  double e0 = 0.0;
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e0, 0, 0, 0, 0);
  if (energy_accumulate) { *energy_accumulate += e0; }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 0, d);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 1, d);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 2, d);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 0, d);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 1, d);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 2, d);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 0, d);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 1, d);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 2, d);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 0, d);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 1, d);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 2, d);
  }
}

double hessian(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  double cosphi;
  double cse_p11_t1_invsqrt51421;
  double cse_p11_t2_invr51422;
  double cse_p11_t3_invsqrt51423;
  double cse_p12_t100_g51523;
  double cse_p12_t102_g51525;
  double cse_p12_t103_g51526;
  double cse_p12_t104_g51527;
  double cse_p12_t105_g51528;
  double cse_p12_t106_g51529;
  double cse_p12_t107_g51530;
  double cse_p12_t108_g51531;
  double cse_p12_t109_g51532;
  double cse_p12_t10_g51433;
  double cse_p12_t110_g51533;
  double cse_p12_t111_g51534;
  double cse_p12_t112_g51535;
  double cse_p12_t113_g51536;
  double cse_p12_t114_g51537;
  double cse_p12_t115_g51538;
  double cse_p12_t116_g51539;
  double cse_p12_t117_g51540;
  double cse_p12_t118_g51541;
  double cse_p12_t119_g51542;
  double cse_p12_t11_g51434;
  double cse_p12_t120_g51543;
  double cse_p12_t121_g51544;
  double cse_p12_t122_g51545;
  double cse_p12_t123_g51546;
  double cse_p12_t124_g51547;
  double cse_p12_t125_g51548;
  double cse_p12_t126_g51549;
  double cse_p12_t127_g51550;
  double cse_p12_t128_g51551;
  double cse_p12_t129_g51552;
  double cse_p12_t12_g51435;
  double cse_p12_t130_g51553;
  double cse_p12_t131_g51554;
  double cse_p12_t132_g51555;
  double cse_p12_t133_g51556;
  double cse_p12_t134_g51557;
  double cse_p12_t135_g51558;
  double cse_p12_t136_g51559;
  double cse_p12_t137_g51560;
  double cse_p12_t138_g51561;
  double cse_p12_t139_g51562;
  double cse_p12_t13_g51436;
  double cse_p12_t140_g51563;
  double cse_p12_t141_g51564;
  double cse_p12_t142_g51565;
  double cse_p12_t143_g51566;
  double cse_p12_t144_g51567;
  double cse_p12_t145_g51568;
  double cse_p12_t146_g51569;
  double cse_p12_t147_g51570;
  double cse_p12_t148_g51571;
  double cse_p12_t149_g51572;
  double cse_p12_t14_g51437;
  double cse_p12_t150_g51573;
  double cse_p12_t151_g51574;
  double cse_p12_t152_g51575;
  double cse_p12_t153_g51576;
  double cse_p12_t154_g51577;
  double cse_p12_t155_g51578;
  double cse_p12_t156_g51579;
  double cse_p12_t157_g51580;
  double cse_p12_t158_g51581;
  double cse_p12_t159_g51582;
  double cse_p12_t15_g51438;
  double cse_p12_t160_g51583;
  double cse_p12_t161_g51584;
  double cse_p12_t162_g51585;
  double cse_p12_t163_g51586;
  double cse_p12_t164_g51587;
  double cse_p12_t165_g51588;
  double cse_p12_t166_g51589;
  double cse_p12_t167_g51590;
  double cse_p12_t168_g51591;
  double cse_p12_t169_g51592;
  double cse_p12_t16_g51439;
  double cse_p12_t170_g51593;
  double cse_p12_t171_g51594;
  double cse_p12_t172_g51595;
  double cse_p12_t173_g51596;
  double cse_p12_t174_g51597;
  double cse_p12_t175_g51598;
  double cse_p12_t176_g51599;
  double cse_p12_t177_g51600;
  double cse_p12_t178_g51601;
  double cse_p12_t179_g51602;
  double cse_p12_t17_g51440;
  double cse_p12_t180_g51603;
  double cse_p12_t18_g51441;
  double cse_p12_t19_g51442;
  double cse_p12_t1_g51604;
  double cse_p12_t1_g51605;
  double cse_p12_t1_g51606;
  double cse_p12_t1_g51607;
  double cse_p12_t1_g51608;
  double cse_p12_t1_g51609;
  double cse_p12_t1_g51610;
  double cse_p12_t1_g51611;
  double cse_p12_t1_g51612;
  double cse_p12_t20_g51443;
  double cse_p12_t21_g51444;
  double cse_p12_t22_g51445;
  double cse_p12_t23_g51446;
  double cse_p12_t24_g51447;
  double cse_p12_t25_g51448;
  double cse_p12_t26_g51449;
  double cse_p12_t27_g51450;
  double cse_p12_t28_g51451;
  double cse_p12_t29_g51452;
  double cse_p12_t30_g51453;
  double cse_p12_t31_g51454;
  double cse_p12_t32_g51455;
  double cse_p12_t33_g51456;
  double cse_p12_t34_g51457;
  double cse_p12_t35_g51458;
  double cse_p12_t36_g51459;
  double cse_p12_t37_g51460;
  double cse_p12_t38_g51461;
  double cse_p12_t39_g51462;
  double cse_p12_t40_g51463;
  double cse_p12_t41_g51464;
  double cse_p12_t42_g51465;
  double cse_p12_t43_g51466;
  double cse_p12_t44_g51467;
  double cse_p12_t45_g51468;
  double cse_p12_t46_g51469;
  double cse_p12_t47_g51470;
  double cse_p12_t48_g51471;
  double cse_p12_t49_g51472;
  double cse_p12_t50_g51473;
  double cse_p12_t51_g51474;
  double cse_p12_t52_g51475;
  double cse_p12_t53_g51476;
  double cse_p12_t54_g51477;
  double cse_p12_t56_g51479;
  double cse_p12_t57_g51480;
  double cse_p12_t58_g51481;
  double cse_p12_t59_g51482;
  double cse_p12_t61_g51484;
  double cse_p12_t62_g51485;
  double cse_p12_t63_g51486;
  double cse_p12_t64_g51487;
  double cse_p12_t65_g51488;
  double cse_p12_t66_g51489;
  double cse_p12_t68_g51491;
  double cse_p12_t70_g51493;
  double cse_p12_t71_g51494;
  double cse_p12_t72_g51495;
  double cse_p12_t73_g51496;
  double cse_p12_t75_g51498;
  double cse_p12_t76_g51499;
  double cse_p12_t77_g51500;
  double cse_p12_t78_g51501;
  double cse_p12_t79_g51502;
  double cse_p12_t7_g51430;
  double cse_p12_t80_g51503;
  double cse_p12_t81_g51504;
  double cse_p12_t82_g51505;
  double cse_p12_t83_g51506;
  double cse_p12_t84_g51507;
  double cse_p12_t85_g51508;
  double cse_p12_t86_g51509;
  double cse_p12_t88_g51511;
  double cse_p12_t89_g51512;
  double cse_p12_t8_g51431;
  double cse_p12_t90_g51513;
  double cse_p12_t91_g51514;
  double cse_p12_t92_g51515;
  double cse_p12_t93_g51516;
  double cse_p12_t95_g51518;
  double cse_p12_t96_g51519;
  double cse_p12_t98_g51521;
  double cse_p12_t99_g51522;
  double cse_p12_t9_g51432;
  double cse_p13_t1_g51614;
  double cse_p13_t1_g51615;
  double cse_p13_t1_g51616;
  double cse_p13_t1_g51617;
  double cse_p13_t1_g51618;
  double cse_p13_t1_g51619;
  double cse_p13_t1_g51620;
  double cse_p13_t1_g51621;
  double cse_p13_t1_g51622;
  double cse_p13_t1_g51623;
  double cse_p14_t1_g51624;
  double cse_p14_t1_g51625;
  double cse_p14_t1_g51626;
  double cse_p14_t1_g51627;
  double cse_p14_t1_g51628;
  double cse_p14_t1_g51629;
  double cse_p14_t1_g51630;
  double cse_p14_t1_g51631;
  double cse_p14_t1_g51632;
  double cse_p15_t1_g51635;
  double cse_p15_t1_g51636;
  double cse_p15_t1_g51637;
  double cse_p21_t1_g51638;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double energy_added;
  double g_x1;
  double g_x2;
  double g_x3;
  double g_x4;
  double g_y1;
  double g_y2;
  double g_y3;
  double g_y4;
  double g_z1;
  double g_z2;
  double g_z3;
  double g_z4;
  double h_x1_x1;
  double h_x1_x2;
  double h_x1_x3;
  double h_x1_x4;
  double h_x1_y1;
  double h_x1_y2;
  double h_x1_y3;
  double h_x1_y4;
  double h_x1_z1;
  double h_x1_z2;
  double h_x1_z3;
  double h_x1_z4;
  double h_x2_x2;
  double h_x2_x3;
  double h_x2_x4;
  double h_x2_y2;
  double h_x2_y3;
  double h_x2_y4;
  double h_x2_z2;
  double h_x2_z3;
  double h_x2_z4;
  double h_x3_x3;
  double h_x3_x4;
  double h_x3_y3;
  double h_x3_y4;
  double h_x3_z3;
  double h_x3_z4;
  double h_x4_x4;
  double h_x4_y4;
  double h_x4_z4;
  double h_y1_x2;
  double h_y1_x3;
  double h_y1_x4;
  double h_y1_y1;
  double h_y1_y2;
  double h_y1_y3;
  double h_y1_y4;
  double h_y1_z1;
  double h_y1_z2;
  double h_y1_z3;
  double h_y1_z4;
  double h_y2_x3;
  double h_y2_x4;
  double h_y2_y2;
  double h_y2_y3;
  double h_y2_y4;
  double h_y2_z2;
  double h_y2_z3;
  double h_y2_z4;
  double h_y3_x4;
  double h_y3_y3;
  double h_y3_y4;
  double h_y3_z3;
  double h_y3_z4;
  double h_y4_y4;
  double h_y4_z4;
  double h_z1_x2;
  double h_z1_x3;
  double h_z1_x4;
  double h_z1_y2;
  double h_z1_y3;
  double h_z1_y4;
  double h_z1_z1;
  double h_z1_z2;
  double h_z1_z3;
  double h_z1_z4;
  double h_z2_x3;
  double h_z2_x4;
  double h_z2_y3;
  double h_z2_y4;
  double h_z2_z2;
  double h_z2_z3;
  double h_z2_z4;
  double h_z3_x4;
  double h_z3_y4;
  double h_z3_z3;
  double h_z3_z4;
  double h_z4_z4;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  energy_added = 0.0000000000000000    ;
  {
    /* !BASE */
    DOUBLE x1 = position[i3x1 + 0];
    DOUBLE y1 = position[i3x1 + 1];
    DOUBLE z1 = position[i3x1 + 2];
    DOUBLE x2 = position[i3x2 + 0];
    DOUBLE y2 = position[i3x2 + 1];
    DOUBLE z2 = position[i3x2 + 2];
    DOUBLE x3 = position[i3x3 + 0];
    DOUBLE y3 = position[i3x3 + 1];
    DOUBLE z3 = position[i3x3 + 2];
    DOUBLE x4 = position[i3x4 + 0];
    DOUBLE y4 = position[i3x4 + 1];
    DOUBLE z4 = position[i3x4 + 2];
    {
      /* !BASE */
      dx12 = (x2 + (-(x1)));
      dy12 = (y2 + (-(y1)));
      dz12 = (z2 + (-(z1)));
      dx23 = (x3 + (-(x2)));
      cse_p12_t157_g51580 = ((-(dx12)) + (-(dx23)));
      cse_p12_t163_g51586 = (dx12 + dx23);
      dy23 = (y3 + (-(y2)));
      cse_p12_t159_g51582 = ((-(dy12)) + (-(dy23)));
      cse_p12_t165_g51588 = (dy12 + dy23);
      dz23 = (z3 + (-(z2)));
      cse_p12_t161_g51584 = ((-(dz12)) + (-(dz23)));
      cse_p12_t167_g51590 = (dz12 + dz23);
      dx34 = (x4 + (-(x3)));
      cse_p12_t158_g51581 = ((-(dx23)) + (-(dx34)));
      cse_p12_t164_g51587 = (dx23 + dx34);
      dy34 = (y4 + (-(y3)));
      cse_p12_t160_g51583 = ((-(dy23)) + (-(dy34)));
      cse_p12_t166_g51589 = (dy23 + dy34);
      dz34 = (z4 + (-(z3)));
      cse_p12_t162_g51585 = ((-(dz23)) + (-(dz34)));
      cse_p12_t168_g51591 = (dz23 + dz34);
      n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
      cse_p12_t31_g51454 = (dy12 * n1x);
      cse_p12_t33_g51456 = (dy23 * n1x);
      cse_p12_t35_g51458 = (dy34 * n1x);
      cse_p13_t1_g51623 = (cse_p12_t159_g51582 * n1x);
      cse_p12_t56_g51479 = (cse_p12_t160_g51583 * n1x);
      cse_p12_t57_g51480 = (cse_p12_t167_g51590 * n1x);
      cse_p12_t58_g51481 = (cse_p12_t168_g51591 * n1x);
      cse_p12_t59_g51482 = (n1x * (-(dz12)));
      cse_p13_t1_g51619 = (n1x * (-(dz23)));
      cse_p12_t61_g51484 = (n1x * (-(dz34)));
      n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
      cse_p12_t37_g51460 = (dz12 * n1y);
      cse_p12_t39_g51462 = (dz23 * n1y);
      cse_p12_t41_g51464 = (dz34 * n1y);
      cse_p12_t62_g51485 = (cse_p12_t161_g51584 * n1y);
      cse_p12_t63_g51486 = (cse_p12_t162_g51585 * n1y);
      cse_p12_t64_g51487 = (cse_p12_t163_g51586 * n1y);
      cse_p12_t65_g51488 = (cse_p12_t164_g51587 * n1y);
      cse_p12_t66_g51489 = (n1y * (-(dx12)));
      cse_p13_t1_g51615 = (n1y * (-(dx23)));
      cse_p12_t68_g51491 = (n1y * (-(dx34)));
      cse_p12_t135_g51558 = (cse_p12_t31_g51454 + cse_p12_t31_g51454 + cse_p12_t66_g51489 + cse_p12_t66_g51489);
      cse_p12_t137_g51560 = (cse_p12_t33_g51456 + cse_p12_t33_g51456 + cse_p13_t1_g51615 + cse_p13_t1_g51615);
      cse_p12_t138_g51561 = (cse_p12_t33_g51456 + cse_p13_t1_g51615);
      cse_p12_t151_g51574 = (cse_p12_t64_g51487 + cse_p12_t64_g51487 + cse_p13_t1_g51623 + cse_p13_t1_g51623);
      n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
      cse_p12_t25_g51448 = (dx12 * n1z);
      cse_p12_t27_g51450 = (dx23 * n1z);
      cse_p12_t29_g51452 = (dx34 * n1z);
      cse_p13_t1_g51621 = (cse_p12_t157_g51580 * n1z);
      cse_p12_t70_g51493 = (cse_p12_t158_g51581 * n1z);
      cse_p12_t71_g51494 = (cse_p12_t165_g51588 * n1z);
      cse_p12_t72_g51495 = (cse_p12_t166_g51589 * n1z);
      cse_p12_t73_g51496 = (n1z * (-(dy12)));
      cse_p13_t1_g51617 = (n1z * (-(dy23)));
      cse_p12_t75_g51498 = (n1z * (-(dy34)));
      cse_p12_t127_g51550 = (cse_p12_t25_g51448 + cse_p12_t25_g51448 + cse_p12_t59_g51482 + cse_p12_t59_g51482);
      cse_p12_t129_g51552 = (cse_p12_t27_g51450 + cse_p12_t27_g51450 + cse_p13_t1_g51619 + cse_p13_t1_g51619);
      cse_p12_t130_g51553 = (cse_p12_t27_g51450 + cse_p13_t1_g51619);
      cse_p12_t143_g51566 = (cse_p12_t37_g51460 + cse_p12_t37_g51460 + cse_p12_t73_g51496 + cse_p12_t73_g51496);
      cse_p12_t145_g51568 = (cse_p12_t39_g51462 + cse_p12_t39_g51462 + cse_p13_t1_g51617 + cse_p13_t1_g51617);
      cse_p12_t146_g51569 = (cse_p12_t39_g51462 + cse_p13_t1_g51617);
      cse_p12_t152_g51575 = (cse_p12_t57_g51480 + cse_p12_t57_g51480 + cse_p13_t1_g51621 + cse_p13_t1_g51621);
      cse_p12_t153_g51576 = (cse_p12_t62_g51485 + cse_p12_t62_g51485 + cse_p12_t71_g51494 + cse_p12_t71_g51494);
      n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
      cse_p12_t32_g51455 = (dy12 * n2x);
      cse_p12_t34_g51457 = (dy23 * n2x);
      cse_p12_t36_g51459 = (dy34 * n2x);
      cse_p12_t82_g51505 = (cse_p12_t159_g51582 * n2x);
      cse_p12_t83_g51506 = (cse_p12_t160_g51583 * n2x);
      cse_p12_t84_g51507 = (cse_p12_t167_g51590 * n2x);
      cse_p12_t85_g51508 = (cse_p12_t168_g51591 * n2x);
      cse_p12_t86_g51509 = (n2x * (-(dz12)));
      cse_p13_t1_g51620 = (n2x * (-(dz23)));
      cse_p12_t88_g51511 = (n2x * (-(dz34)));
      n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
      cse_p12_t38_g51461 = (dz12 * n2y);
      cse_p12_t40_g51463 = (dz23 * n2y);
      cse_p12_t42_g51465 = (dz34 * n2y);
      cse_p12_t89_g51512 = (cse_p12_t161_g51584 * n2y);
      cse_p12_t90_g51513 = (cse_p12_t162_g51585 * n2y);
      cse_p12_t91_g51514 = (cse_p12_t163_g51586 * n2y);
      cse_p12_t92_g51515 = (cse_p12_t164_g51587 * n2y);
      cse_p12_t93_g51516 = (n2y * (-(dx12)));
      cse_p13_t1_g51616 = (n2y * (-(dx23)));
      cse_p12_t95_g51518 = (n2y * (-(dx34)));
      cse_p12_t136_g51559 = (cse_p12_t32_g51455 + cse_p12_t56_g51479 + cse_p12_t65_g51488 + cse_p12_t93_g51516);
      cse_p12_t139_g51562 = (cse_p12_t34_g51457 + cse_p12_t34_g51457 + cse_p13_t1_g51616 + cse_p13_t1_g51616);
      cse_p12_t140_g51563 = (cse_p12_t34_g51457 + cse_p13_t1_g51616);
      cse_p12_t141_g51564 = (cse_p12_t35_g51458 + cse_p12_t68_g51491 + cse_p12_t82_g51505 + cse_p12_t91_g51514);
      cse_p12_t142_g51565 = (cse_p12_t36_g51459 + cse_p12_t36_g51459 + cse_p12_t95_g51518 + cse_p12_t95_g51518);
      cse_p12_t154_g51577 = (cse_p12_t83_g51506 + cse_p12_t83_g51506 + cse_p12_t92_g51515 + cse_p12_t92_g51515);
      n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
      cse_p12_t26_g51449 = (dx12 * n2z);
      cse_p12_t28_g51451 = (dx23 * n2z);
      cse_p12_t30_g51453 = (dx34 * n2z);
      cse_p12_t96_g51519 = (cse_p12_t157_g51580 * n2z);
      cse_p13_t1_g51622 = (cse_p12_t158_g51581 * n2z);
      cse_p12_t98_g51521 = (cse_p12_t165_g51588 * n2z);
      cse_p12_t99_g51522 = (cse_p12_t166_g51589 * n2z);
      cse_p12_t100_g51523 = (n2z * (-(dy12)));
      cse_p13_t1_g51618 = (n2z * (-(dy23)));
      cse_p12_t102_g51525 = (n2z * (-(dy34)));
      cse_p12_t128_g51551 = (cse_p12_t26_g51449 + cse_p12_t58_g51481 + cse_p12_t70_g51493 + cse_p12_t86_g51509);
      cse_p12_t131_g51554 = (cse_p12_t28_g51451 + cse_p12_t28_g51451 + cse_p13_t1_g51620 + cse_p13_t1_g51620);
      cse_p12_t132_g51555 = (cse_p12_t28_g51451 + cse_p13_t1_g51620);
      cse_p12_t133_g51556 = (cse_p12_t29_g51452 + cse_p12_t61_g51484 + cse_p12_t84_g51507 + cse_p12_t96_g51519);
      cse_p12_t134_g51557 = (cse_p12_t30_g51453 + cse_p12_t30_g51453 + cse_p12_t88_g51511 + cse_p12_t88_g51511);
      cse_p12_t144_g51567 = (cse_p12_t100_g51523 + cse_p12_t38_g51461 + cse_p12_t63_g51486 + cse_p12_t72_g51495);
      cse_p12_t147_g51570 = (cse_p12_t40_g51463 + cse_p12_t40_g51463 + cse_p13_t1_g51618 + cse_p13_t1_g51618);
      cse_p12_t148_g51571 = (cse_p12_t40_g51463 + cse_p13_t1_g51618);
      cse_p12_t149_g51572 = (cse_p12_t41_g51464 + cse_p12_t75_g51498 + cse_p12_t89_g51512 + cse_p12_t98_g51521);
      cse_p12_t150_g51573 = (cse_p12_t102_g51525 + cse_p12_t102_g51525 + cse_p12_t42_g51465 + cse_p12_t42_g51465);
      cse_p12_t155_g51578 = (cse_p12_t85_g51508 + cse_p12_t85_g51508 + cse_p13_t1_g51622 + cse_p13_t1_g51622);
      cse_p12_t156_g51579 = (cse_p12_t90_g51513 + cse_p12_t90_g51513 + cse_p12_t99_g51522 + cse_p12_t99_g51522);
      n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
      cse_p12_t76_g51499 = (cse_p12_t134_g51557 * n1_2);
      cse_p12_t77_g51500 = (cse_p12_t142_g51565 * n1_2);
      cse_p12_t78_g51501 = (cse_p12_t150_g51573 * n1_2);
      cse_p12_t79_g51502 = (cse_p12_t154_g51577 * n1_2);
      cse_p12_t80_g51503 = (cse_p12_t155_g51578 * n1_2);
      cse_p12_t81_g51504 = (cse_p12_t156_g51579 * n1_2);
      n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
      cse_p12_t103_g51526 = (cse_p12_t127_g51550 * n2_2);
      cse_p12_t104_g51527 = (cse_p12_t135_g51558 * n2_2);
      cse_p12_t105_g51528 = (cse_p12_t143_g51566 * n2_2);
      cse_p12_t106_g51529 = (cse_p12_t151_g51574 * n2_2);
      cse_p12_t107_g51530 = (cse_p12_t152_g51575 * n2_2);
      cse_p12_t108_g51531 = (cse_p12_t153_g51576 * n2_2);
      cse_p12_t121_g51544 = (cse_p12_t107_g51530 + cse_p12_t76_g51499);
      cse_p12_t122_g51545 = (cse_p12_t106_g51529 + cse_p12_t77_g51500);
      cse_p12_t123_g51546 = (cse_p12_t108_g51531 + cse_p12_t78_g51501);
      cse_p12_t124_g51547 = (cse_p12_t104_g51527 + cse_p12_t79_g51502);
      cse_p12_t125_g51548 = (cse_p12_t103_g51526 + cse_p12_t80_g51503);
      cse_p12_t126_g51549 = (cse_p12_t105_g51528 + cse_p12_t81_g51504);
      cse_p11_t1_invsqrt51421 = (1.0 / sqrt((n1_2 * n2_2)));
      cse_p11_t2_invr51422 = (cse_p11_t1_invsqrt51421 * cse_p11_t1_invsqrt51421);
      cse_p12_t43_g51466 = (cse_p11_t1_invsqrt51421 * cse_p12_t128_g51551);
      cse_p12_t44_g51467 = (cse_p11_t1_invsqrt51421 * cse_p12_t130_g51553);
      cse_p12_t45_g51468 = (cse_p11_t1_invsqrt51421 * cse_p12_t132_g51555);
      cse_p12_t46_g51469 = (cse_p11_t1_invsqrt51421 * cse_p12_t133_g51556);
      cse_p12_t47_g51470 = (cse_p11_t1_invsqrt51421 * cse_p12_t136_g51559);
      cse_p12_t48_g51471 = (cse_p11_t1_invsqrt51421 * cse_p12_t138_g51561);
      cse_p12_t49_g51472 = (cse_p11_t1_invsqrt51421 * cse_p12_t140_g51563);
      cse_p12_t50_g51473 = (cse_p11_t1_invsqrt51421 * cse_p12_t141_g51564);
      cse_p12_t51_g51474 = (cse_p11_t1_invsqrt51421 * cse_p12_t144_g51567);
      cse_p12_t52_g51475 = (cse_p11_t1_invsqrt51421 * cse_p12_t146_g51569);
      cse_p12_t53_g51476 = (cse_p11_t1_invsqrt51421 * cse_p12_t148_g51571);
      cse_p12_t54_g51477 = (cse_p11_t1_invsqrt51421 * cse_p12_t149_g51572);
      dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
      cse_p12_t1_g51605 = (-0.50000000000000000     * dot_n1n2);
      cse_p12_t1_g51606 = (cse_p11_t1_invsqrt51421 * cse_p11_t2_invr51422 * cse_p12_t1_g51605);
      cse_p12_t1_g51607 = (cse_p12_t121_g51544 * cse_p12_t1_g51606);
      cse_p12_t1_g51608 = (cse_p12_t122_g51545 * cse_p12_t1_g51606);
      cse_p12_t1_g51609 = (cse_p12_t123_g51546 * cse_p12_t1_g51606);
      cse_p12_t1_g51610 = (cse_p12_t124_g51547 * cse_p12_t1_g51606);
      cse_p12_t1_g51611 = (cse_p12_t125_g51548 * cse_p12_t1_g51606);
      cse_p12_t1_g51612 = (cse_p12_t126_g51549 * cse_p12_t1_g51606);
      cse_p14_t1_g51631 = (cse_p12_t1_g51606 * n1_2);
      cse_p12_t7_g51430 = (cse_p12_t131_g51554 * cse_p14_t1_g51631);
      cse_p12_t8_g51431 = (cse_p12_t139_g51562 * cse_p14_t1_g51631);
      cse_p12_t9_g51432 = (cse_p12_t147_g51570 * cse_p14_t1_g51631);
      cse_p14_t1_g51632 = (cse_p12_t1_g51606 * n2_2);
      cse_p12_t10_g51433 = (cse_p12_t129_g51552 * cse_p14_t1_g51632);
      cse_p12_t11_g51434 = (cse_p12_t137_g51560 * cse_p14_t1_g51632);
      cse_p12_t12_g51435 = (cse_p12_t145_g51568 * cse_p14_t1_g51632);
      cse_p12_t109_g51532 = (cse_p12_t1_g51607 + cse_p12_t46_g51469);
      cse_p12_t110_g51533 = (cse_p12_t1_g51608 + cse_p12_t50_g51473);
      cse_p12_t111_g51534 = (cse_p12_t1_g51609 + cse_p12_t54_g51477);
      cse_p12_t112_g51535 = (cse_p12_t1_g51610 + cse_p12_t47_g51470);
      cse_p12_t113_g51536 = (cse_p12_t1_g51611 + cse_p12_t43_g51466);
      cse_p12_t114_g51537 = (cse_p12_t1_g51612 + cse_p12_t51_g51474);
      cse_p12_t115_g51538 = (cse_p12_t44_g51467 + cse_p12_t7_g51430);
      cse_p12_t116_g51539 = (cse_p12_t48_g51471 + cse_p12_t8_g51431);
      cse_p12_t117_g51540 = (cse_p12_t52_g51475 + cse_p12_t9_g51432);
      cse_p12_t118_g51541 = (cse_p12_t10_g51433 + cse_p12_t45_g51468);
      cse_p12_t119_g51542 = (cse_p12_t11_g51434 + cse_p12_t49_g51472);
      cse_p12_t120_g51543 = (cse_p12_t12_g51435 + cse_p12_t53_g51476);
      cosphi = (cse_p11_t1_invsqrt51421 * dot_n1n2);
      phi = acos(cosphi);
      deltaphi = (phi + (-(phi0)));
      cse_p13_t1_g51614 = (deltaphi * kdh);
      energy = (cse_p13_t1_g51614 * deltaphi);
      energy_added += energy;
      *energy_accumulate += energy;
      cse_p11_t3_invsqrt51423 = (1.0 / sqrt((1.0000000000000000     + (-(((cosphi) * (cosphi)))))));
      cse_p12_t13_g51436 = (cse_p11_t3_invsqrt51423 * cse_p12_t109_g51532);
      cse_p12_t14_g51437 = (cse_p11_t3_invsqrt51423 * cse_p12_t110_g51533);
      cse_p12_t15_g51438 = (cse_p11_t3_invsqrt51423 * cse_p12_t111_g51534);
      cse_p12_t16_g51439 = (cse_p11_t3_invsqrt51423 * cse_p12_t112_g51535);
      cse_p12_t17_g51440 = (cse_p11_t3_invsqrt51423 * cse_p12_t113_g51536);
      cse_p12_t18_g51441 = (cse_p11_t3_invsqrt51423 * cse_p12_t114_g51537);
      cse_p12_t19_g51442 = (cse_p11_t3_invsqrt51423 * cse_p12_t115_g51538);
      cse_p12_t20_g51443 = (cse_p11_t3_invsqrt51423 * cse_p12_t116_g51539);
      cse_p12_t21_g51444 = (cse_p11_t3_invsqrt51423 * cse_p12_t117_g51540);
      cse_p12_t22_g51445 = (cse_p11_t3_invsqrt51423 * cse_p12_t118_g51541);
      cse_p12_t23_g51446 = (cse_p11_t3_invsqrt51423 * cse_p12_t119_g51542);
      cse_p12_t24_g51447 = (cse_p11_t3_invsqrt51423 * cse_p12_t120_g51543);
      cse_p12_t169_g51592 = (-(cse_p12_t13_g51436));
      cse_p12_t170_g51593 = (-(cse_p12_t14_g51437));
      cse_p12_t171_g51594 = (-(cse_p12_t15_g51438));
      cse_p12_t172_g51595 = (-(cse_p12_t16_g51439));
      cse_p12_t173_g51596 = (-(cse_p12_t17_g51440));
      cse_p12_t174_g51597 = (-(cse_p12_t18_g51441));
      cse_p12_t175_g51598 = (-(cse_p12_t19_g51442));
      cse_p12_t176_g51599 = (-(cse_p12_t20_g51443));
      cse_p12_t177_g51600 = (-(cse_p12_t21_g51444));
      cse_p12_t178_g51601 = (-(cse_p12_t22_g51445));
      cse_p12_t179_g51602 = (-(cse_p12_t23_g51446));
      cse_p12_t180_g51603 = (-(cse_p12_t24_g51447));
      cse_p21_t1_g51638 = (cse_p11_t3_invsqrt51423 * cse_p13_t1_g51614);
      g_x1 = ((-((cse_p12_t120_g51543 * cse_p21_t1_g51638))) + (-((cse_p12_t120_g51543 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x1, 0, g_x1);
      g_y1 = ((-((cse_p12_t118_g51541 * cse_p21_t1_g51638))) + (-((cse_p12_t118_g51541 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x1, 1, g_y1);
      g_z1 = ((-((cse_p12_t119_g51542 * cse_p21_t1_g51638))) + (-((cse_p12_t119_g51542 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x1, 2, g_z1);
      g_x2 = ((-((cse_p12_t111_g51534 * cse_p21_t1_g51638))) + (-((cse_p12_t111_g51534 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x2, 0, g_x2);
      g_y2 = ((-((cse_p12_t109_g51532 * cse_p21_t1_g51638))) + (-((cse_p12_t109_g51532 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x2, 1, g_y2);
      g_z2 = ((-((cse_p12_t110_g51533 * cse_p21_t1_g51638))) + (-((cse_p12_t110_g51533 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x2, 2, g_z2);
      g_x3 = ((-((cse_p12_t114_g51537 * cse_p21_t1_g51638))) + (-((cse_p12_t114_g51537 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x3, 0, g_x3);
      g_y3 = ((-((cse_p12_t113_g51536 * cse_p21_t1_g51638))) + (-((cse_p12_t113_g51536 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x3, 1, g_y3);
      g_z3 = ((-((cse_p12_t112_g51535 * cse_p21_t1_g51638))) + (-((cse_p12_t112_g51535 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x3, 2, g_z3);
      g_x4 = ((-((cse_p12_t117_g51540 * cse_p21_t1_g51638))) + (-((cse_p12_t117_g51540 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x4, 0, g_x4);
      g_y4 = ((-((cse_p12_t115_g51538 * cse_p21_t1_g51638))) + (-((cse_p12_t115_g51538 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x4, 1, g_y4);
      g_z4 = ((-((cse_p12_t116_g51539 * cse_p21_t1_g51638))) + (-((cse_p12_t116_g51539 * cse_p21_t1_g51638))));
      KernelGradientAcc(i3x4, 2, g_z4);
      cse_p12_t1_g51604 = (2.0000000000000000     * kdh);
      h_x1_x1 = (cse_p12_t180_g51603 * cse_p12_t180_g51603 * cse_p12_t1_g51604);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 0, h_x1_x1);
      cse_p15_t1_g51637 = (cse_p12_t178_g51601 * cse_p12_t1_g51604);
      h_x1_y1 = (cse_p12_t180_g51603 * cse_p15_t1_g51637);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 1, h_x1_y1);
      h_x1_z1 = (cse_p12_t179_g51602 * cse_p12_t180_g51603 * cse_p12_t1_g51604);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 2, h_x1_z1);
      cse_p14_t1_g51626 = (cse_p12_t171_g51594 * cse_p12_t1_g51604);
      h_x1_x2 = (cse_p12_t180_g51603 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 0, h_x1_x2);
      cse_p14_t1_g51624 = (cse_p12_t169_g51592 * cse_p12_t1_g51604);
      h_x1_y2 = (cse_p12_t180_g51603 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 1, h_x1_y2);
      cse_p14_t1_g51625 = (cse_p12_t170_g51593 * cse_p12_t1_g51604);
      h_x1_z2 = (cse_p12_t180_g51603 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 2, h_x1_z2);
      cse_p14_t1_g51629 = (cse_p12_t174_g51597 * cse_p12_t1_g51604);
      h_x1_x3 = (cse_p12_t180_g51603 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 0, h_x1_x3);
      cse_p14_t1_g51628 = (cse_p12_t173_g51596 * cse_p12_t1_g51604);
      h_x1_y3 = (cse_p12_t180_g51603 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 1, h_x1_y3);
      cse_p14_t1_g51627 = (cse_p12_t172_g51595 * cse_p12_t1_g51604);
      h_x1_z3 = (cse_p12_t180_g51603 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 2, h_x1_z3);
      cse_p15_t1_g51636 = (cse_p12_t177_g51600 * cse_p12_t1_g51604);
      h_x1_x4 = (cse_p12_t180_g51603 * cse_p15_t1_g51636);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 0, h_x1_x4);
      cse_p14_t1_g51630 = (cse_p12_t175_g51598 * cse_p12_t1_g51604);
      h_x1_y4 = (cse_p12_t180_g51603 * cse_p14_t1_g51630);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 1, h_x1_y4);
      cse_p15_t1_g51635 = (cse_p12_t176_g51599 * cse_p12_t1_g51604);
      h_x1_z4 = (cse_p12_t180_g51603 * cse_p15_t1_g51635);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 2, h_x1_z4);
      h_y1_y1 = (cse_p12_t178_g51601 * cse_p15_t1_g51637);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x1, 1, h_y1_y1);
      h_y1_z1 = (cse_p12_t179_g51602 * cse_p15_t1_g51637);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x1, 2, h_y1_z1);
      h_y1_x2 = (cse_p12_t178_g51601 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 0, h_y1_x2);
      h_y1_y2 = (cse_p12_t178_g51601 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 1, h_y1_y2);
      h_y1_z2 = (cse_p12_t178_g51601 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 2, h_y1_z2);
      h_y1_x3 = (cse_p12_t178_g51601 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 0, h_y1_x3);
      h_y1_y3 = (cse_p12_t178_g51601 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 1, h_y1_y3);
      h_y1_z3 = (cse_p12_t178_g51601 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 2, h_y1_z3);
      h_y1_x4 = (cse_p12_t178_g51601 * cse_p15_t1_g51636);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 0, h_y1_x4);
      h_y1_y4 = (cse_p12_t178_g51601 * cse_p14_t1_g51630);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 1, h_y1_y4);
      h_y1_z4 = (cse_p12_t178_g51601 * cse_p15_t1_g51635);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 2, h_y1_z4);
      h_z1_z1 = (cse_p12_t179_g51602 * cse_p12_t179_g51602 * cse_p12_t1_g51604);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x1, 2, h_z1_z1);
      h_z1_x2 = (cse_p12_t179_g51602 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 0, h_z1_x2);
      h_z1_y2 = (cse_p12_t179_g51602 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 1, h_z1_y2);
      h_z1_z2 = (cse_p12_t179_g51602 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 2, h_z1_z2);
      h_z1_x3 = (cse_p12_t179_g51602 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 0, h_z1_x3);
      h_z1_y3 = (cse_p12_t179_g51602 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 1, h_z1_y3);
      h_z1_z3 = (cse_p12_t179_g51602 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 2, h_z1_z3);
      h_z1_x4 = (cse_p12_t179_g51602 * cse_p15_t1_g51636);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 0, h_z1_x4);
      h_z1_y4 = (cse_p12_t179_g51602 * cse_p14_t1_g51630);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 1, h_z1_y4);
      h_z1_z4 = (cse_p12_t179_g51602 * cse_p15_t1_g51635);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 2, h_z1_z4);
      h_x2_x2 = (cse_p12_t171_g51594 * cse_p14_t1_g51626);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 0, h_x2_x2);
      h_x2_y2 = (cse_p12_t171_g51594 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 1, h_x2_y2);
      h_x2_z2 = (cse_p12_t171_g51594 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 2, h_x2_z2);
      h_x2_x3 = (cse_p12_t174_g51597 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 0, h_x2_x3);
      h_x2_y3 = (cse_p12_t173_g51596 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 1, h_x2_y3);
      h_x2_z3 = (cse_p12_t172_g51595 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 2, h_x2_z3);
      h_x2_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 0, h_x2_x4);
      h_x2_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 1, h_x2_y4);
      h_x2_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51626);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 2, h_x2_z4);
      h_y2_y2 = (cse_p12_t169_g51592 * cse_p14_t1_g51624);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x2, 1, h_y2_y2);
      h_y2_z2 = (cse_p12_t170_g51593 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x2, 2, h_y2_z2);
      h_y2_x3 = (cse_p12_t174_g51597 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 0, h_y2_x3);
      h_y2_y3 = (cse_p12_t173_g51596 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 1, h_y2_y3);
      h_y2_z3 = (cse_p12_t172_g51595 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 2, h_y2_z3);
      h_y2_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 0, h_y2_x4);
      h_y2_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 1, h_y2_y4);
      h_y2_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51624);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 2, h_y2_z4);
      h_z2_z2 = (cse_p12_t170_g51593 * cse_p14_t1_g51625);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x2, 2, h_z2_z2);
      h_z2_x3 = (cse_p12_t174_g51597 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 0, h_z2_x3);
      h_z2_y3 = (cse_p12_t173_g51596 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 1, h_z2_y3);
      h_z2_z3 = (cse_p12_t172_g51595 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 2, h_z2_z3);
      h_z2_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 0, h_z2_x4);
      h_z2_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 1, h_z2_y4);
      h_z2_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51625);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 2, h_z2_z4);
      h_x3_x3 = (cse_p12_t174_g51597 * cse_p14_t1_g51629);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 0, h_x3_x3);
      h_x3_y3 = (cse_p12_t174_g51597 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 1, h_x3_y3);
      h_x3_z3 = (cse_p12_t174_g51597 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 2, h_x3_z3);
      h_x3_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 0, h_x3_x4);
      h_x3_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 1, h_x3_y4);
      h_x3_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51629);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 2, h_x3_z4);
      h_y3_y3 = (cse_p12_t173_g51596 * cse_p14_t1_g51628);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x3, 1, h_y3_y3);
      h_y3_z3 = (cse_p12_t173_g51596 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x3, 2, h_y3_z3);
      h_y3_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 0, h_y3_x4);
      h_y3_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 1, h_y3_y4);
      h_y3_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51628);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 2, h_y3_z4);
      h_z3_z3 = (cse_p12_t172_g51595 * cse_p14_t1_g51627);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x3, 2, h_z3_z3);
      h_z3_x4 = (cse_p12_t177_g51600 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 0, h_z3_x4);
      h_z3_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 1, h_z3_y4);
      h_z3_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51627);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 2, h_z3_z4);
      h_x4_x4 = (cse_p12_t177_g51600 * cse_p15_t1_g51636);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 0, h_x4_x4);
      h_x4_y4 = (cse_p12_t177_g51600 * cse_p14_t1_g51630);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 1, h_x4_y4);
      h_x4_z4 = (cse_p12_t177_g51600 * cse_p15_t1_g51635);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 2, h_x4_z4);
      h_y4_y4 = (cse_p12_t175_g51598 * cse_p14_t1_g51630);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 1, i3x4, 1, h_y4_y4);
      h_y4_z4 = (cse_p12_t176_g51599 * cse_p14_t1_g51630);
      KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 1, i3x4, 2, h_y4_z4);
      h_z4_z4 = (cse_p12_t176_g51599 * cse_p15_t1_g51635);
      KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 2, i3x4, 2, h_z4_z4);
    }
  }
  return energy_added;
}
void hessian_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  constexpr size_t PositionSize = 12;
  const double h = 1.0e-5;
  const double inv2h = 1.0/(2.0*h);
  const double invh2 = 1.0/((h*h));
  double e0 = 0.0;
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e0, 0, 0, 0, 0);
  if (energy_accumulate) { *energy_accumulate += e0; }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 0, d);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 1, d);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 2, d);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 0, d);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 1, d);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 2, d);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 0, d);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 1, d);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 2, d);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 0, d);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 1, d);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 2, d);
  }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 0, i3x1, 0, hval);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 1, i3x1, 1, hval);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 2, hval);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x2, 0, hval);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x2, 1, hval);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 2, hval);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x3, 0, hval);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x3, 1, hval);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 2, hval);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x4, 0, hval);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x4, 1, hval);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 2, hval);
  }
  {
    double saved_i = position[i3x1 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x1 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x1 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x4 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x4 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x4, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x4 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x4 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x4 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x4 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x4 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x4 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 1, hval);
  }
}

};
