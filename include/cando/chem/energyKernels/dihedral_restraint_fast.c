template <typename HESSIAN>
struct Dihedral_Restraint_Fast {
  static constexpr size_t PositionSize = 12;
  static std::string description() { return "mathkernel-dihedral_restraint_fast"; };
void energy(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  /* !BASE */
  double cosphi;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double inv_n1n2;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  DOUBLE x1 = position[i3x1 + 0];
  DOUBLE y1 = position[i3x1 + 1];
  DOUBLE z1 = position[i3x1 + 2];
  DOUBLE x2 = position[i3x2 + 0];
  DOUBLE y2 = position[i3x2 + 1];
  DOUBLE z2 = position[i3x2 + 2];
  DOUBLE x3 = position[i3x3 + 0];
  DOUBLE y3 = position[i3x3 + 1];
  DOUBLE z3 = position[i3x3 + 2];
  DOUBLE x4 = position[i3x4 + 0];
  DOUBLE y4 = position[i3x4 + 1];
  DOUBLE z4 = position[i3x4 + 2];
  {
    /* !BASE */
    dx12 = (x2 + (-(x1)));
    dy12 = (y2 + (-(y1)));
    dz12 = (z2 + (-(z1)));
    dx23 = (x3 + (-(x2)));
    dy23 = (y3 + (-(y2)));
    dz23 = (z3 + (-(z2)));
    dx34 = (x4 + (-(x3)));
    dy34 = (y4 + (-(y3)));
    dz34 = (z4 + (-(z3)));
    n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
    n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
    n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
    n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
    n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
    n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
    n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
    n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
    inv_n1n2 = (1.0 / sqrt((n1_2 * n2_2)));
    dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
    cosphi = (dot_n1n2 * inv_n1n2);
    phi = acos(cosphi);
    deltaphi = (phi + (-(phi0)));
    energy = (deltaphi * deltaphi * kdh);
    *energy_accumulate += energy;
  }
}
void energy_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, energy_accumulate, force, hessian, dvec, hdvec);
}

void gradient(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  /* !BASE */
  double cosphi;
  double cse_p12_t10_g17010;
  double cse_p12_t11_g17011;
  double cse_p12_t12_g17012;
  double cse_p12_t13_g17013;
  double cse_p12_t14_g17014;
  double cse_p12_t15_g17015;
  double cse_p12_t16_g17016;
  double cse_p12_t17_g17017;
  double cse_p12_t18_g17018;
  double cse_p12_t19_g17019;
  double cse_p12_t1_g17001;
  double cse_p12_t1_g17049;
  double cse_p12_t1_g17050;
  double cse_p12_t1_g17051;
  double cse_p12_t1_g17052;
  double cse_p12_t20_g17020;
  double cse_p12_t21_g17021;
  double cse_p12_t22_g17022;
  double cse_p12_t23_g17023;
  double cse_p12_t24_g17024;
  double cse_p12_t25_g17025;
  double cse_p12_t26_g17026;
  double cse_p12_t27_g17027;
  double cse_p12_t28_g17028;
  double cse_p12_t29_g17029;
  double cse_p12_t2_g17002;
  double cse_p12_t30_g17030;
  double cse_p12_t31_g17031;
  double cse_p12_t32_g17032;
  double cse_p12_t33_g17033;
  double cse_p12_t34_g17034;
  double cse_p12_t35_g17035;
  double cse_p12_t36_g17036;
  double cse_p12_t37_g17037;
  double cse_p12_t38_g17038;
  double cse_p12_t39_g17039;
  double cse_p12_t3_g17003;
  double cse_p12_t40_g17040;
  double cse_p12_t41_g17041;
  double cse_p12_t42_g17042;
  double cse_p12_t43_g17043;
  double cse_p12_t44_g17044;
  double cse_p12_t45_g17045;
  double cse_p12_t46_g17046;
  double cse_p12_t47_g17047;
  double cse_p12_t48_g17048;
  double cse_p12_t4_g17004;
  double cse_p12_t5_g17005;
  double cse_p12_t6_g17006;
  double cse_p12_t7_g17007;
  double cse_p12_t8_g17008;
  double cse_p12_t9_g17009;
  double cse_p1_t1_invsqrt16998;
  double cse_p1_t2_invr16999;
  double cse_p1_t3_invsqrt17000;
  double cse_p21_t1_g17053;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double g_x1;
  double g_x2;
  double g_x3;
  double g_x4;
  double g_y1;
  double g_y2;
  double g_y3;
  double g_y4;
  double g_z1;
  double g_z2;
  double g_z3;
  double g_z4;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  DOUBLE x1 = position[i3x1 + 0];
  DOUBLE y1 = position[i3x1 + 1];
  DOUBLE z1 = position[i3x1 + 2];
  DOUBLE x2 = position[i3x2 + 0];
  DOUBLE y2 = position[i3x2 + 1];
  DOUBLE z2 = position[i3x2 + 2];
  DOUBLE x3 = position[i3x3 + 0];
  DOUBLE y3 = position[i3x3 + 1];
  DOUBLE z3 = position[i3x3 + 2];
  DOUBLE x4 = position[i3x4 + 0];
  DOUBLE y4 = position[i3x4 + 1];
  DOUBLE z4 = position[i3x4 + 2];
  {
    /* !BASE */
    dx12 = (x2 + (-(x1)));
    dy12 = (y2 + (-(y1)));
    dz12 = (z2 + (-(z1)));
    dx23 = (x3 + (-(x2)));
    cse_p12_t37_g17037 = ((-(dx12)) + (-(dx23)));
    cse_p12_t43_g17043 = (dx12 + dx23);
    dy23 = (y3 + (-(y2)));
    cse_p12_t39_g17039 = ((-(dy12)) + (-(dy23)));
    cse_p12_t45_g17045 = (dy12 + dy23);
    dz23 = (z3 + (-(z2)));
    cse_p12_t41_g17041 = ((-(dz12)) + (-(dz23)));
    cse_p12_t47_g17047 = (dz12 + dz23);
    dx34 = (x4 + (-(x3)));
    cse_p12_t38_g17038 = ((-(dx23)) + (-(dx34)));
    cse_p12_t44_g17044 = (dx23 + dx34);
    dy34 = (y4 + (-(y3)));
    cse_p12_t40_g17040 = ((-(dy23)) + (-(dy34)));
    cse_p12_t46_g17046 = (dy23 + dy34);
    dz34 = (z4 + (-(z3)));
    cse_p12_t42_g17042 = ((-(dz23)) + (-(dz34)));
    cse_p12_t48_g17048 = (dz23 + dz34);
    n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
    cse_p12_t5_g17005 = (dy12 * n1x);
    cse_p12_t6_g17006 = (dy23 * n1x);
    cse_p12_t13_g17013 = (cse_p12_t39_g17039 * n1x);
    cse_p12_t14_g17014 = (cse_p12_t47_g17047 * n1x);
    cse_p12_t15_g17015 = (n1x * (-(dz12)));
    cse_p12_t16_g17016 = (n1x * (-(dz23)));
    n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
    cse_p12_t9_g17009 = (dz12 * n1y);
    cse_p12_t10_g17010 = (dz23 * n1y);
    cse_p12_t17_g17017 = (cse_p12_t41_g17041 * n1y);
    cse_p12_t18_g17018 = (cse_p12_t43_g17043 * n1y);
    cse_p12_t19_g17019 = (n1y * (-(dx12)));
    cse_p12_t20_g17020 = (n1y * (-(dx23)));
    n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
    cse_p12_t1_g17001 = (dx12 * n1z);
    cse_p12_t2_g17002 = (dx23 * n1z);
    cse_p12_t21_g17021 = (cse_p12_t37_g17037 * n1z);
    cse_p12_t22_g17022 = (cse_p12_t45_g17045 * n1z);
    cse_p12_t23_g17023 = (n1z * (-(dy12)));
    cse_p12_t24_g17024 = (n1z * (-(dy23)));
    n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
    cse_p12_t7_g17007 = (dy23 * n2x);
    cse_p12_t8_g17008 = (dy34 * n2x);
    cse_p12_t25_g17025 = (cse_p12_t40_g17040 * n2x);
    cse_p12_t26_g17026 = (cse_p12_t48_g17048 * n2x);
    cse_p12_t27_g17027 = (n2x * (-(dz23)));
    cse_p12_t28_g17028 = (n2x * (-(dz34)));
    n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
    cse_p12_t11_g17011 = (dz23 * n2y);
    cse_p12_t12_g17012 = (dz34 * n2y);
    cse_p12_t29_g17029 = (cse_p12_t42_g17042 * n2y);
    cse_p12_t30_g17030 = (cse_p12_t44_g17044 * n2y);
    cse_p12_t31_g17031 = (n2y * (-(dx23)));
    cse_p12_t32_g17032 = (n2y * (-(dx34)));
    n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
    cse_p12_t3_g17003 = (dx23 * n2z);
    cse_p12_t4_g17004 = (dx34 * n2z);
    cse_p12_t33_g17033 = (cse_p12_t38_g17038 * n2z);
    cse_p12_t34_g17034 = (cse_p12_t46_g17046 * n2z);
    cse_p12_t35_g17035 = (n2z * (-(dy23)));
    cse_p12_t36_g17036 = (n2z * (-(dy34)));
    n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
    n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
    cse_p1_t1_invsqrt16998 = (1.0 / sqrt((n1_2 * n2_2)));
    cse_p1_t2_invr16999 = (cse_p1_t1_invsqrt16998 * cse_p1_t1_invsqrt16998);
    dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
    cosphi = (cse_p1_t1_invsqrt16998 * dot_n1n2);
    phi = acos(cosphi);
    deltaphi = (phi + (-(phi0)));
    cse_p12_t1_g17050 = (deltaphi * kdh);
    energy = (cse_p12_t1_g17050 * deltaphi);
    *energy_accumulate += energy;
    cse_p1_t3_invsqrt17000 = (1.0 / sqrt((1.0000000000000000     + (-(((cosphi) * (cosphi)))))));
    cse_p12_t1_g17049 = (-0.50000000000000000     * cse_p1_t1_invsqrt16998 * cse_p1_t2_invr16999 * dot_n1n2);
    cse_p12_t1_g17052 = (cse_p12_t1_g17049 * n2_2);
    cse_p21_t1_g17053 = (cse_p12_t1_g17050 * cse_p1_t3_invsqrt17000);
    g_x1 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t10_g17010 + cse_p12_t10_g17010 + cse_p12_t24_g17024 + cse_p12_t24_g17024)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t11_g17011 + cse_p12_t35_g17035)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t10_g17010 + cse_p12_t10_g17010 + cse_p12_t24_g17024 + cse_p12_t24_g17024)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t11_g17011 + cse_p12_t35_g17035)))))));
    KernelGradientAcc(i3x1, 0, g_x1);
    g_y1 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t16_g17016 + cse_p12_t16_g17016 + cse_p12_t2_g17002 + cse_p12_t2_g17002)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t27_g17027 + cse_p12_t3_g17003)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t16_g17016 + cse_p12_t16_g17016 + cse_p12_t2_g17002 + cse_p12_t2_g17002)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t27_g17027 + cse_p12_t3_g17003)))))));
    KernelGradientAcc(i3x1, 1, g_y1);
    g_z1 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t20_g17020 + cse_p12_t20_g17020 + cse_p12_t6_g17006 + cse_p12_t6_g17006)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t31_g17031 + cse_p12_t7_g17007)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17052 * (cse_p12_t20_g17020 + cse_p12_t20_g17020 + cse_p12_t6_g17006 + cse_p12_t6_g17006)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t31_g17031 + cse_p12_t7_g17007)))))));
    KernelGradientAcc(i3x1, 2, g_z1);
    g_x2 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t12_g17012 + cse_p12_t12_g17012 + cse_p12_t36_g17036 + cse_p12_t36_g17036)) + (n2_2 * (cse_p12_t17_g17017 + cse_p12_t17_g17017 + cse_p12_t22_g17022 + cse_p12_t22_g17022)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t41_g17041 * n2y) + (cse_p12_t45_g17045 * n2z) + (dz34 * n1y) + (n1z * (-(dy34))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t12_g17012 + cse_p12_t12_g17012 + cse_p12_t36_g17036 + cse_p12_t36_g17036)) + (n2_2 * (cse_p12_t17_g17017 + cse_p12_t17_g17017 + cse_p12_t22_g17022 + cse_p12_t22_g17022)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t41_g17041 * n2y) + (cse_p12_t45_g17045 * n2z) + (dz34 * n1y) + (n1z * (-(dy34))))))))));
    KernelGradientAcc(i3x2, 0, g_x2);
    g_y2 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t28_g17028 + cse_p12_t28_g17028 + cse_p12_t4_g17004 + cse_p12_t4_g17004)) + (n2_2 * (cse_p12_t14_g17014 + cse_p12_t14_g17014 + cse_p12_t21_g17021 + cse_p12_t21_g17021)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t37_g17037 * n2z) + (cse_p12_t47_g17047 * n2x) + (dx34 * n1z) + (n1x * (-(dz34))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t28_g17028 + cse_p12_t28_g17028 + cse_p12_t4_g17004 + cse_p12_t4_g17004)) + (n2_2 * (cse_p12_t14_g17014 + cse_p12_t14_g17014 + cse_p12_t21_g17021 + cse_p12_t21_g17021)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t37_g17037 * n2z) + (cse_p12_t47_g17047 * n2x) + (dx34 * n1z) + (n1x * (-(dz34))))))))));
    KernelGradientAcc(i3x2, 1, g_y2);
    g_z2 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t32_g17032 + cse_p12_t32_g17032 + cse_p12_t8_g17008 + cse_p12_t8_g17008)) + (n2_2 * (cse_p12_t13_g17013 + cse_p12_t13_g17013 + cse_p12_t18_g17018 + cse_p12_t18_g17018)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t39_g17039 * n2x) + (cse_p12_t43_g17043 * n2y) + (dy34 * n1x) + (n1y * (-(dx34))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t32_g17032 + cse_p12_t32_g17032 + cse_p12_t8_g17008 + cse_p12_t8_g17008)) + (n2_2 * (cse_p12_t13_g17013 + cse_p12_t13_g17013 + cse_p12_t18_g17018 + cse_p12_t18_g17018)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t39_g17039 * n2x) + (cse_p12_t43_g17043 * n2y) + (dy34 * n1x) + (n1y * (-(dx34))))))))));
    KernelGradientAcc(i3x2, 2, g_z2);
    g_x3 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t29_g17029 + cse_p12_t29_g17029 + cse_p12_t34_g17034 + cse_p12_t34_g17034)) + (n2_2 * (cse_p12_t23_g17023 + cse_p12_t23_g17023 + cse_p12_t9_g17009 + cse_p12_t9_g17009)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t42_g17042 * n1y) + (cse_p12_t46_g17046 * n1z) + (dz12 * n2y) + (n2z * (-(dy12))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t29_g17029 + cse_p12_t29_g17029 + cse_p12_t34_g17034 + cse_p12_t34_g17034)) + (n2_2 * (cse_p12_t23_g17023 + cse_p12_t23_g17023 + cse_p12_t9_g17009 + cse_p12_t9_g17009)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t42_g17042 * n1y) + (cse_p12_t46_g17046 * n1z) + (dz12 * n2y) + (n2z * (-(dy12))))))))));
    KernelGradientAcc(i3x3, 0, g_x3);
    g_y3 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t26_g17026 + cse_p12_t26_g17026 + cse_p12_t33_g17033 + cse_p12_t33_g17033)) + (n2_2 * (cse_p12_t15_g17015 + cse_p12_t15_g17015 + cse_p12_t1_g17001 + cse_p12_t1_g17001)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t38_g17038 * n1z) + (cse_p12_t48_g17048 * n1x) + (dx12 * n2z) + (n2x * (-(dz12))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t26_g17026 + cse_p12_t26_g17026 + cse_p12_t33_g17033 + cse_p12_t33_g17033)) + (n2_2 * (cse_p12_t15_g17015 + cse_p12_t15_g17015 + cse_p12_t1_g17001 + cse_p12_t1_g17001)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t38_g17038 * n1z) + (cse_p12_t48_g17048 * n1x) + (dx12 * n2z) + (n2x * (-(dz12))))))))));
    KernelGradientAcc(i3x3, 1, g_y3);
    g_z3 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t25_g17025 + cse_p12_t25_g17025 + cse_p12_t30_g17030 + cse_p12_t30_g17030)) + (n2_2 * (cse_p12_t19_g17019 + cse_p12_t19_g17019 + cse_p12_t5_g17005 + cse_p12_t5_g17005)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t40_g17040 * n1x) + (cse_p12_t44_g17044 * n1y) + (dy12 * n2x) + (n2y * (-(dx12))))))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17049 * ((n1_2 * (cse_p12_t25_g17025 + cse_p12_t25_g17025 + cse_p12_t30_g17030 + cse_p12_t30_g17030)) + (n2_2 * (cse_p12_t19_g17019 + cse_p12_t19_g17019 + cse_p12_t5_g17005 + cse_p12_t5_g17005)))) + (cse_p1_t1_invsqrt16998 * ((cse_p12_t40_g17040 * n1x) + (cse_p12_t44_g17044 * n1y) + (dy12 * n2x) + (n2y * (-(dx12))))))))));
    KernelGradientAcc(i3x3, 2, g_z3);
    cse_p12_t1_g17051 = (cse_p12_t1_g17049 * n1_2);
    g_x4 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t11_g17011 + cse_p12_t11_g17011 + cse_p12_t35_g17035 + cse_p12_t35_g17035)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t10_g17010 + cse_p12_t24_g17024)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t11_g17011 + cse_p12_t11_g17011 + cse_p12_t35_g17035 + cse_p12_t35_g17035)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t10_g17010 + cse_p12_t24_g17024)))))));
    KernelGradientAcc(i3x4, 0, g_x4);
    g_y4 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t27_g17027 + cse_p12_t27_g17027 + cse_p12_t3_g17003 + cse_p12_t3_g17003)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t16_g17016 + cse_p12_t2_g17002)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t27_g17027 + cse_p12_t27_g17027 + cse_p12_t3_g17003 + cse_p12_t3_g17003)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t16_g17016 + cse_p12_t2_g17002)))))));
    KernelGradientAcc(i3x4, 1, g_y4);
    g_z4 = ((-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t31_g17031 + cse_p12_t31_g17031 + cse_p12_t7_g17007 + cse_p12_t7_g17007)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t20_g17020 + cse_p12_t6_g17006)))))) + (-((cse_p21_t1_g17053 * ((cse_p12_t1_g17051 * (cse_p12_t31_g17031 + cse_p12_t31_g17031 + cse_p12_t7_g17007 + cse_p12_t7_g17007)) + (cse_p1_t1_invsqrt16998 * (cse_p12_t20_g17020 + cse_p12_t6_g17006)))))));
    KernelGradientAcc(i3x4, 2, g_z4);
  }
}
void gradient_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  constexpr size_t PositionSize = 12;
  const double h = 1.0e-5;
  const double inv2h = 1.0/(2.0*h);
  double e0 = 0.0;
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e0, 0, 0, 0, 0);
  if (energy_accumulate) { *energy_accumulate += e0; }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 0, d);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 1, d);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 2, d);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 0, d);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 1, d);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 2, d);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 0, d);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 1, d);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 2, d);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 0, d);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 1, d);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 2, d);
  }
}

void hessian(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec) {
  /* !BASE */
  double cosphi;
  double cse_p11_t1_invsqrt17057;
  double cse_p11_t2_invr17058;
  double cse_p11_t3_invsqrt17059;
  double cse_p12_t100_g17159;
  double cse_p12_t102_g17161;
  double cse_p12_t103_g17162;
  double cse_p12_t104_g17163;
  double cse_p12_t105_g17164;
  double cse_p12_t106_g17165;
  double cse_p12_t107_g17166;
  double cse_p12_t108_g17167;
  double cse_p12_t109_g17168;
  double cse_p12_t10_g17069;
  double cse_p12_t110_g17169;
  double cse_p12_t111_g17170;
  double cse_p12_t112_g17171;
  double cse_p12_t113_g17172;
  double cse_p12_t114_g17173;
  double cse_p12_t115_g17174;
  double cse_p12_t116_g17175;
  double cse_p12_t117_g17176;
  double cse_p12_t118_g17177;
  double cse_p12_t119_g17178;
  double cse_p12_t11_g17070;
  double cse_p12_t120_g17179;
  double cse_p12_t121_g17180;
  double cse_p12_t122_g17181;
  double cse_p12_t123_g17182;
  double cse_p12_t124_g17183;
  double cse_p12_t125_g17184;
  double cse_p12_t126_g17185;
  double cse_p12_t127_g17186;
  double cse_p12_t128_g17187;
  double cse_p12_t129_g17188;
  double cse_p12_t12_g17071;
  double cse_p12_t130_g17189;
  double cse_p12_t131_g17190;
  double cse_p12_t132_g17191;
  double cse_p12_t133_g17192;
  double cse_p12_t134_g17193;
  double cse_p12_t135_g17194;
  double cse_p12_t136_g17195;
  double cse_p12_t137_g17196;
  double cse_p12_t138_g17197;
  double cse_p12_t139_g17198;
  double cse_p12_t13_g17072;
  double cse_p12_t140_g17199;
  double cse_p12_t141_g17200;
  double cse_p12_t142_g17201;
  double cse_p12_t143_g17202;
  double cse_p12_t144_g17203;
  double cse_p12_t145_g17204;
  double cse_p12_t146_g17205;
  double cse_p12_t147_g17206;
  double cse_p12_t148_g17207;
  double cse_p12_t149_g17208;
  double cse_p12_t14_g17073;
  double cse_p12_t150_g17209;
  double cse_p12_t151_g17210;
  double cse_p12_t152_g17211;
  double cse_p12_t153_g17212;
  double cse_p12_t154_g17213;
  double cse_p12_t155_g17214;
  double cse_p12_t156_g17215;
  double cse_p12_t157_g17216;
  double cse_p12_t158_g17217;
  double cse_p12_t159_g17218;
  double cse_p12_t15_g17074;
  double cse_p12_t160_g17219;
  double cse_p12_t161_g17220;
  double cse_p12_t162_g17221;
  double cse_p12_t163_g17222;
  double cse_p12_t164_g17223;
  double cse_p12_t165_g17224;
  double cse_p12_t166_g17225;
  double cse_p12_t167_g17226;
  double cse_p12_t168_g17227;
  double cse_p12_t169_g17228;
  double cse_p12_t16_g17075;
  double cse_p12_t170_g17229;
  double cse_p12_t171_g17230;
  double cse_p12_t172_g17231;
  double cse_p12_t173_g17232;
  double cse_p12_t174_g17233;
  double cse_p12_t175_g17234;
  double cse_p12_t176_g17235;
  double cse_p12_t177_g17236;
  double cse_p12_t178_g17237;
  double cse_p12_t179_g17238;
  double cse_p12_t17_g17076;
  double cse_p12_t180_g17239;
  double cse_p12_t18_g17077;
  double cse_p12_t19_g17078;
  double cse_p12_t1_g17240;
  double cse_p12_t1_g17241;
  double cse_p12_t1_g17242;
  double cse_p12_t1_g17243;
  double cse_p12_t1_g17244;
  double cse_p12_t1_g17245;
  double cse_p12_t1_g17246;
  double cse_p12_t1_g17247;
  double cse_p12_t1_g17248;
  double cse_p12_t20_g17079;
  double cse_p12_t21_g17080;
  double cse_p12_t22_g17081;
  double cse_p12_t23_g17082;
  double cse_p12_t24_g17083;
  double cse_p12_t25_g17084;
  double cse_p12_t26_g17085;
  double cse_p12_t27_g17086;
  double cse_p12_t28_g17087;
  double cse_p12_t29_g17088;
  double cse_p12_t30_g17089;
  double cse_p12_t31_g17090;
  double cse_p12_t32_g17091;
  double cse_p12_t33_g17092;
  double cse_p12_t34_g17093;
  double cse_p12_t35_g17094;
  double cse_p12_t36_g17095;
  double cse_p12_t37_g17096;
  double cse_p12_t38_g17097;
  double cse_p12_t39_g17098;
  double cse_p12_t40_g17099;
  double cse_p12_t41_g17100;
  double cse_p12_t42_g17101;
  double cse_p12_t43_g17102;
  double cse_p12_t44_g17103;
  double cse_p12_t45_g17104;
  double cse_p12_t46_g17105;
  double cse_p12_t47_g17106;
  double cse_p12_t48_g17107;
  double cse_p12_t49_g17108;
  double cse_p12_t50_g17109;
  double cse_p12_t51_g17110;
  double cse_p12_t52_g17111;
  double cse_p12_t53_g17112;
  double cse_p12_t54_g17113;
  double cse_p12_t56_g17115;
  double cse_p12_t57_g17116;
  double cse_p12_t58_g17117;
  double cse_p12_t59_g17118;
  double cse_p12_t61_g17120;
  double cse_p12_t62_g17121;
  double cse_p12_t63_g17122;
  double cse_p12_t64_g17123;
  double cse_p12_t65_g17124;
  double cse_p12_t66_g17125;
  double cse_p12_t68_g17127;
  double cse_p12_t70_g17129;
  double cse_p12_t71_g17130;
  double cse_p12_t72_g17131;
  double cse_p12_t73_g17132;
  double cse_p12_t75_g17134;
  double cse_p12_t76_g17135;
  double cse_p12_t77_g17136;
  double cse_p12_t78_g17137;
  double cse_p12_t79_g17138;
  double cse_p12_t7_g17066;
  double cse_p12_t80_g17139;
  double cse_p12_t81_g17140;
  double cse_p12_t82_g17141;
  double cse_p12_t83_g17142;
  double cse_p12_t84_g17143;
  double cse_p12_t85_g17144;
  double cse_p12_t86_g17145;
  double cse_p12_t88_g17147;
  double cse_p12_t89_g17148;
  double cse_p12_t8_g17067;
  double cse_p12_t90_g17149;
  double cse_p12_t91_g17150;
  double cse_p12_t92_g17151;
  double cse_p12_t93_g17152;
  double cse_p12_t95_g17154;
  double cse_p12_t96_g17155;
  double cse_p12_t98_g17157;
  double cse_p12_t99_g17158;
  double cse_p12_t9_g17068;
  double cse_p13_t1_g17250;
  double cse_p13_t1_g17251;
  double cse_p13_t1_g17252;
  double cse_p13_t1_g17253;
  double cse_p13_t1_g17254;
  double cse_p13_t1_g17255;
  double cse_p13_t1_g17256;
  double cse_p13_t1_g17257;
  double cse_p13_t1_g17258;
  double cse_p13_t1_g17259;
  double cse_p14_t1_g17260;
  double cse_p14_t1_g17261;
  double cse_p14_t1_g17262;
  double cse_p14_t1_g17263;
  double cse_p14_t1_g17264;
  double cse_p14_t1_g17265;
  double cse_p14_t1_g17266;
  double cse_p14_t1_g17267;
  double cse_p14_t1_g17268;
  double cse_p15_t1_g17271;
  double cse_p15_t1_g17272;
  double cse_p15_t1_g17273;
  double cse_p21_t1_g17274;
  double deltaphi;
  double dot_n1n2;
  double dx12;
  double dx23;
  double dx34;
  double dy12;
  double dy23;
  double dy34;
  double dz12;
  double dz23;
  double dz34;
  double energy;
  double g_x1;
  double g_x2;
  double g_x3;
  double g_x4;
  double g_y1;
  double g_y2;
  double g_y3;
  double g_y4;
  double g_z1;
  double g_z2;
  double g_z3;
  double g_z4;
  double h_x1_x1;
  double h_x1_x2;
  double h_x1_x3;
  double h_x1_x4;
  double h_x1_y1;
  double h_x1_y2;
  double h_x1_y3;
  double h_x1_y4;
  double h_x1_z1;
  double h_x1_z2;
  double h_x1_z3;
  double h_x1_z4;
  double h_x2_x2;
  double h_x2_x3;
  double h_x2_x4;
  double h_x2_y2;
  double h_x2_y3;
  double h_x2_y4;
  double h_x2_z2;
  double h_x2_z3;
  double h_x2_z4;
  double h_x3_x3;
  double h_x3_x4;
  double h_x3_y3;
  double h_x3_y4;
  double h_x3_z3;
  double h_x3_z4;
  double h_x4_x4;
  double h_x4_y4;
  double h_x4_z4;
  double h_y1_x2;
  double h_y1_x3;
  double h_y1_x4;
  double h_y1_y1;
  double h_y1_y2;
  double h_y1_y3;
  double h_y1_y4;
  double h_y1_z1;
  double h_y1_z2;
  double h_y1_z3;
  double h_y1_z4;
  double h_y2_x3;
  double h_y2_x4;
  double h_y2_y2;
  double h_y2_y3;
  double h_y2_y4;
  double h_y2_z2;
  double h_y2_z3;
  double h_y2_z4;
  double h_y3_x4;
  double h_y3_y3;
  double h_y3_y4;
  double h_y3_z3;
  double h_y3_z4;
  double h_y4_y4;
  double h_y4_z4;
  double h_z1_x2;
  double h_z1_x3;
  double h_z1_x4;
  double h_z1_y2;
  double h_z1_y3;
  double h_z1_y4;
  double h_z1_z1;
  double h_z1_z2;
  double h_z1_z3;
  double h_z1_z4;
  double h_z2_x3;
  double h_z2_x4;
  double h_z2_y3;
  double h_z2_y4;
  double h_z2_z2;
  double h_z2_z3;
  double h_z2_z4;
  double h_z3_x4;
  double h_z3_y4;
  double h_z3_z3;
  double h_z3_z4;
  double h_z4_z4;
  double n1x;
  double n1y;
  double n1z;
  double n1_2;
  double n2x;
  double n2y;
  double n2z;
  double n2_2;
  double phi;
  DOUBLE x1 = position[i3x1 + 0];
  DOUBLE y1 = position[i3x1 + 1];
  DOUBLE z1 = position[i3x1 + 2];
  DOUBLE x2 = position[i3x2 + 0];
  DOUBLE y2 = position[i3x2 + 1];
  DOUBLE z2 = position[i3x2 + 2];
  DOUBLE x3 = position[i3x3 + 0];
  DOUBLE y3 = position[i3x3 + 1];
  DOUBLE z3 = position[i3x3 + 2];
  DOUBLE x4 = position[i3x4 + 0];
  DOUBLE y4 = position[i3x4 + 1];
  DOUBLE z4 = position[i3x4 + 2];
  {
    /* !BASE */
    dx12 = (x2 + (-(x1)));
    dy12 = (y2 + (-(y1)));
    dz12 = (z2 + (-(z1)));
    dx23 = (x3 + (-(x2)));
    cse_p12_t157_g17216 = ((-(dx12)) + (-(dx23)));
    cse_p12_t163_g17222 = (dx12 + dx23);
    dy23 = (y3 + (-(y2)));
    cse_p12_t159_g17218 = ((-(dy12)) + (-(dy23)));
    cse_p12_t165_g17224 = (dy12 + dy23);
    dz23 = (z3 + (-(z2)));
    cse_p12_t161_g17220 = ((-(dz12)) + (-(dz23)));
    cse_p12_t167_g17226 = (dz12 + dz23);
    dx34 = (x4 + (-(x3)));
    cse_p12_t158_g17217 = ((-(dx23)) + (-(dx34)));
    cse_p12_t164_g17223 = (dx23 + dx34);
    dy34 = (y4 + (-(y3)));
    cse_p12_t160_g17219 = ((-(dy23)) + (-(dy34)));
    cse_p12_t166_g17225 = (dy23 + dy34);
    dz34 = (z4 + (-(z3)));
    cse_p12_t162_g17221 = ((-(dz23)) + (-(dz34)));
    cse_p12_t168_g17227 = (dz23 + dz34);
    n1x = ((dy12 * dz23) + (-((dy23 * dz12))));
    cse_p12_t31_g17090 = (dy12 * n1x);
    cse_p12_t33_g17092 = (dy23 * n1x);
    cse_p12_t35_g17094 = (dy34 * n1x);
    cse_p13_t1_g17259 = (cse_p12_t159_g17218 * n1x);
    cse_p12_t56_g17115 = (cse_p12_t160_g17219 * n1x);
    cse_p12_t57_g17116 = (cse_p12_t167_g17226 * n1x);
    cse_p12_t58_g17117 = (cse_p12_t168_g17227 * n1x);
    cse_p12_t59_g17118 = (n1x * (-(dz12)));
    cse_p13_t1_g17255 = (n1x * (-(dz23)));
    cse_p12_t61_g17120 = (n1x * (-(dz34)));
    n1y = ((dx23 * dz12) + (-((dx12 * dz23))));
    cse_p12_t37_g17096 = (dz12 * n1y);
    cse_p12_t39_g17098 = (dz23 * n1y);
    cse_p12_t41_g17100 = (dz34 * n1y);
    cse_p12_t62_g17121 = (cse_p12_t161_g17220 * n1y);
    cse_p12_t63_g17122 = (cse_p12_t162_g17221 * n1y);
    cse_p12_t64_g17123 = (cse_p12_t163_g17222 * n1y);
    cse_p12_t65_g17124 = (cse_p12_t164_g17223 * n1y);
    cse_p12_t66_g17125 = (n1y * (-(dx12)));
    cse_p13_t1_g17251 = (n1y * (-(dx23)));
    cse_p12_t68_g17127 = (n1y * (-(dx34)));
    cse_p12_t135_g17194 = (cse_p12_t31_g17090 + cse_p12_t31_g17090 + cse_p12_t66_g17125 + cse_p12_t66_g17125);
    cse_p12_t137_g17196 = (cse_p12_t33_g17092 + cse_p12_t33_g17092 + cse_p13_t1_g17251 + cse_p13_t1_g17251);
    cse_p12_t138_g17197 = (cse_p12_t33_g17092 + cse_p13_t1_g17251);
    cse_p12_t151_g17210 = (cse_p12_t64_g17123 + cse_p12_t64_g17123 + cse_p13_t1_g17259 + cse_p13_t1_g17259);
    n1z = ((dx12 * dy23) + (-((dx23 * dy12))));
    cse_p12_t25_g17084 = (dx12 * n1z);
    cse_p12_t27_g17086 = (dx23 * n1z);
    cse_p12_t29_g17088 = (dx34 * n1z);
    cse_p13_t1_g17257 = (cse_p12_t157_g17216 * n1z);
    cse_p12_t70_g17129 = (cse_p12_t158_g17217 * n1z);
    cse_p12_t71_g17130 = (cse_p12_t165_g17224 * n1z);
    cse_p12_t72_g17131 = (cse_p12_t166_g17225 * n1z);
    cse_p12_t73_g17132 = (n1z * (-(dy12)));
    cse_p13_t1_g17253 = (n1z * (-(dy23)));
    cse_p12_t75_g17134 = (n1z * (-(dy34)));
    cse_p12_t127_g17186 = (cse_p12_t25_g17084 + cse_p12_t25_g17084 + cse_p12_t59_g17118 + cse_p12_t59_g17118);
    cse_p12_t129_g17188 = (cse_p12_t27_g17086 + cse_p12_t27_g17086 + cse_p13_t1_g17255 + cse_p13_t1_g17255);
    cse_p12_t130_g17189 = (cse_p12_t27_g17086 + cse_p13_t1_g17255);
    cse_p12_t143_g17202 = (cse_p12_t37_g17096 + cse_p12_t37_g17096 + cse_p12_t73_g17132 + cse_p12_t73_g17132);
    cse_p12_t145_g17204 = (cse_p12_t39_g17098 + cse_p12_t39_g17098 + cse_p13_t1_g17253 + cse_p13_t1_g17253);
    cse_p12_t146_g17205 = (cse_p12_t39_g17098 + cse_p13_t1_g17253);
    cse_p12_t152_g17211 = (cse_p12_t57_g17116 + cse_p12_t57_g17116 + cse_p13_t1_g17257 + cse_p13_t1_g17257);
    cse_p12_t153_g17212 = (cse_p12_t62_g17121 + cse_p12_t62_g17121 + cse_p12_t71_g17130 + cse_p12_t71_g17130);
    n2x = ((dy23 * dz34) + (-((dy34 * dz23))));
    cse_p12_t32_g17091 = (dy12 * n2x);
    cse_p12_t34_g17093 = (dy23 * n2x);
    cse_p12_t36_g17095 = (dy34 * n2x);
    cse_p12_t82_g17141 = (cse_p12_t159_g17218 * n2x);
    cse_p12_t83_g17142 = (cse_p12_t160_g17219 * n2x);
    cse_p12_t84_g17143 = (cse_p12_t167_g17226 * n2x);
    cse_p12_t85_g17144 = (cse_p12_t168_g17227 * n2x);
    cse_p12_t86_g17145 = (n2x * (-(dz12)));
    cse_p13_t1_g17256 = (n2x * (-(dz23)));
    cse_p12_t88_g17147 = (n2x * (-(dz34)));
    n2y = ((dx34 * dz23) + (-((dx23 * dz34))));
    cse_p12_t38_g17097 = (dz12 * n2y);
    cse_p12_t40_g17099 = (dz23 * n2y);
    cse_p12_t42_g17101 = (dz34 * n2y);
    cse_p12_t89_g17148 = (cse_p12_t161_g17220 * n2y);
    cse_p12_t90_g17149 = (cse_p12_t162_g17221 * n2y);
    cse_p12_t91_g17150 = (cse_p12_t163_g17222 * n2y);
    cse_p12_t92_g17151 = (cse_p12_t164_g17223 * n2y);
    cse_p12_t93_g17152 = (n2y * (-(dx12)));
    cse_p13_t1_g17252 = (n2y * (-(dx23)));
    cse_p12_t95_g17154 = (n2y * (-(dx34)));
    cse_p12_t136_g17195 = (cse_p12_t32_g17091 + cse_p12_t56_g17115 + cse_p12_t65_g17124 + cse_p12_t93_g17152);
    cse_p12_t139_g17198 = (cse_p12_t34_g17093 + cse_p12_t34_g17093 + cse_p13_t1_g17252 + cse_p13_t1_g17252);
    cse_p12_t140_g17199 = (cse_p12_t34_g17093 + cse_p13_t1_g17252);
    cse_p12_t141_g17200 = (cse_p12_t35_g17094 + cse_p12_t68_g17127 + cse_p12_t82_g17141 + cse_p12_t91_g17150);
    cse_p12_t142_g17201 = (cse_p12_t36_g17095 + cse_p12_t36_g17095 + cse_p12_t95_g17154 + cse_p12_t95_g17154);
    cse_p12_t154_g17213 = (cse_p12_t83_g17142 + cse_p12_t83_g17142 + cse_p12_t92_g17151 + cse_p12_t92_g17151);
    n2z = ((dx23 * dy34) + (-((dx34 * dy23))));
    cse_p12_t26_g17085 = (dx12 * n2z);
    cse_p12_t28_g17087 = (dx23 * n2z);
    cse_p12_t30_g17089 = (dx34 * n2z);
    cse_p12_t96_g17155 = (cse_p12_t157_g17216 * n2z);
    cse_p13_t1_g17258 = (cse_p12_t158_g17217 * n2z);
    cse_p12_t98_g17157 = (cse_p12_t165_g17224 * n2z);
    cse_p12_t99_g17158 = (cse_p12_t166_g17225 * n2z);
    cse_p12_t100_g17159 = (n2z * (-(dy12)));
    cse_p13_t1_g17254 = (n2z * (-(dy23)));
    cse_p12_t102_g17161 = (n2z * (-(dy34)));
    cse_p12_t128_g17187 = (cse_p12_t26_g17085 + cse_p12_t58_g17117 + cse_p12_t70_g17129 + cse_p12_t86_g17145);
    cse_p12_t131_g17190 = (cse_p12_t28_g17087 + cse_p12_t28_g17087 + cse_p13_t1_g17256 + cse_p13_t1_g17256);
    cse_p12_t132_g17191 = (cse_p12_t28_g17087 + cse_p13_t1_g17256);
    cse_p12_t133_g17192 = (cse_p12_t29_g17088 + cse_p12_t61_g17120 + cse_p12_t84_g17143 + cse_p12_t96_g17155);
    cse_p12_t134_g17193 = (cse_p12_t30_g17089 + cse_p12_t30_g17089 + cse_p12_t88_g17147 + cse_p12_t88_g17147);
    cse_p12_t144_g17203 = (cse_p12_t100_g17159 + cse_p12_t38_g17097 + cse_p12_t63_g17122 + cse_p12_t72_g17131);
    cse_p12_t147_g17206 = (cse_p12_t40_g17099 + cse_p12_t40_g17099 + cse_p13_t1_g17254 + cse_p13_t1_g17254);
    cse_p12_t148_g17207 = (cse_p12_t40_g17099 + cse_p13_t1_g17254);
    cse_p12_t149_g17208 = (cse_p12_t41_g17100 + cse_p12_t75_g17134 + cse_p12_t89_g17148 + cse_p12_t98_g17157);
    cse_p12_t150_g17209 = (cse_p12_t102_g17161 + cse_p12_t102_g17161 + cse_p12_t42_g17101 + cse_p12_t42_g17101);
    cse_p12_t155_g17214 = (cse_p12_t85_g17144 + cse_p12_t85_g17144 + cse_p13_t1_g17258 + cse_p13_t1_g17258);
    cse_p12_t156_g17215 = (cse_p12_t90_g17149 + cse_p12_t90_g17149 + cse_p12_t99_g17158 + cse_p12_t99_g17158);
    n1_2 = ((n1x * n1x) + (n1y * n1y) + (n1z * n1z));
    cse_p12_t76_g17135 = (cse_p12_t134_g17193 * n1_2);
    cse_p12_t77_g17136 = (cse_p12_t142_g17201 * n1_2);
    cse_p12_t78_g17137 = (cse_p12_t150_g17209 * n1_2);
    cse_p12_t79_g17138 = (cse_p12_t154_g17213 * n1_2);
    cse_p12_t80_g17139 = (cse_p12_t155_g17214 * n1_2);
    cse_p12_t81_g17140 = (cse_p12_t156_g17215 * n1_2);
    n2_2 = ((n2x * n2x) + (n2y * n2y) + (n2z * n2z));
    cse_p12_t103_g17162 = (cse_p12_t127_g17186 * n2_2);
    cse_p12_t104_g17163 = (cse_p12_t135_g17194 * n2_2);
    cse_p12_t105_g17164 = (cse_p12_t143_g17202 * n2_2);
    cse_p12_t106_g17165 = (cse_p12_t151_g17210 * n2_2);
    cse_p12_t107_g17166 = (cse_p12_t152_g17211 * n2_2);
    cse_p12_t108_g17167 = (cse_p12_t153_g17212 * n2_2);
    cse_p12_t121_g17180 = (cse_p12_t107_g17166 + cse_p12_t76_g17135);
    cse_p12_t122_g17181 = (cse_p12_t106_g17165 + cse_p12_t77_g17136);
    cse_p12_t123_g17182 = (cse_p12_t108_g17167 + cse_p12_t78_g17137);
    cse_p12_t124_g17183 = (cse_p12_t104_g17163 + cse_p12_t79_g17138);
    cse_p12_t125_g17184 = (cse_p12_t103_g17162 + cse_p12_t80_g17139);
    cse_p12_t126_g17185 = (cse_p12_t105_g17164 + cse_p12_t81_g17140);
    cse_p11_t1_invsqrt17057 = (1.0 / sqrt((n1_2 * n2_2)));
    cse_p11_t2_invr17058 = (cse_p11_t1_invsqrt17057 * cse_p11_t1_invsqrt17057);
    cse_p12_t43_g17102 = (cse_p11_t1_invsqrt17057 * cse_p12_t128_g17187);
    cse_p12_t44_g17103 = (cse_p11_t1_invsqrt17057 * cse_p12_t130_g17189);
    cse_p12_t45_g17104 = (cse_p11_t1_invsqrt17057 * cse_p12_t132_g17191);
    cse_p12_t46_g17105 = (cse_p11_t1_invsqrt17057 * cse_p12_t133_g17192);
    cse_p12_t47_g17106 = (cse_p11_t1_invsqrt17057 * cse_p12_t136_g17195);
    cse_p12_t48_g17107 = (cse_p11_t1_invsqrt17057 * cse_p12_t138_g17197);
    cse_p12_t49_g17108 = (cse_p11_t1_invsqrt17057 * cse_p12_t140_g17199);
    cse_p12_t50_g17109 = (cse_p11_t1_invsqrt17057 * cse_p12_t141_g17200);
    cse_p12_t51_g17110 = (cse_p11_t1_invsqrt17057 * cse_p12_t144_g17203);
    cse_p12_t52_g17111 = (cse_p11_t1_invsqrt17057 * cse_p12_t146_g17205);
    cse_p12_t53_g17112 = (cse_p11_t1_invsqrt17057 * cse_p12_t148_g17207);
    cse_p12_t54_g17113 = (cse_p11_t1_invsqrt17057 * cse_p12_t149_g17208);
    dot_n1n2 = ((n1x * n2x) + (n1y * n2y) + (n1z * n2z));
    cse_p12_t1_g17241 = (-0.50000000000000000     * dot_n1n2);
    cse_p12_t1_g17242 = (cse_p11_t1_invsqrt17057 * cse_p11_t2_invr17058 * cse_p12_t1_g17241);
    cse_p12_t1_g17243 = (cse_p12_t121_g17180 * cse_p12_t1_g17242);
    cse_p12_t1_g17244 = (cse_p12_t122_g17181 * cse_p12_t1_g17242);
    cse_p12_t1_g17245 = (cse_p12_t123_g17182 * cse_p12_t1_g17242);
    cse_p12_t1_g17246 = (cse_p12_t124_g17183 * cse_p12_t1_g17242);
    cse_p12_t1_g17247 = (cse_p12_t125_g17184 * cse_p12_t1_g17242);
    cse_p12_t1_g17248 = (cse_p12_t126_g17185 * cse_p12_t1_g17242);
    cse_p14_t1_g17267 = (cse_p12_t1_g17242 * n1_2);
    cse_p12_t7_g17066 = (cse_p12_t131_g17190 * cse_p14_t1_g17267);
    cse_p12_t8_g17067 = (cse_p12_t139_g17198 * cse_p14_t1_g17267);
    cse_p12_t9_g17068 = (cse_p12_t147_g17206 * cse_p14_t1_g17267);
    cse_p14_t1_g17268 = (cse_p12_t1_g17242 * n2_2);
    cse_p12_t10_g17069 = (cse_p12_t129_g17188 * cse_p14_t1_g17268);
    cse_p12_t11_g17070 = (cse_p12_t137_g17196 * cse_p14_t1_g17268);
    cse_p12_t12_g17071 = (cse_p12_t145_g17204 * cse_p14_t1_g17268);
    cse_p12_t109_g17168 = (cse_p12_t1_g17243 + cse_p12_t46_g17105);
    cse_p12_t110_g17169 = (cse_p12_t1_g17244 + cse_p12_t50_g17109);
    cse_p12_t111_g17170 = (cse_p12_t1_g17245 + cse_p12_t54_g17113);
    cse_p12_t112_g17171 = (cse_p12_t1_g17246 + cse_p12_t47_g17106);
    cse_p12_t113_g17172 = (cse_p12_t1_g17247 + cse_p12_t43_g17102);
    cse_p12_t114_g17173 = (cse_p12_t1_g17248 + cse_p12_t51_g17110);
    cse_p12_t115_g17174 = (cse_p12_t44_g17103 + cse_p12_t7_g17066);
    cse_p12_t116_g17175 = (cse_p12_t48_g17107 + cse_p12_t8_g17067);
    cse_p12_t117_g17176 = (cse_p12_t52_g17111 + cse_p12_t9_g17068);
    cse_p12_t118_g17177 = (cse_p12_t10_g17069 + cse_p12_t45_g17104);
    cse_p12_t119_g17178 = (cse_p12_t11_g17070 + cse_p12_t49_g17108);
    cse_p12_t120_g17179 = (cse_p12_t12_g17071 + cse_p12_t53_g17112);
    cosphi = (cse_p11_t1_invsqrt17057 * dot_n1n2);
    phi = acos(cosphi);
    deltaphi = (phi + (-(phi0)));
    cse_p13_t1_g17250 = (deltaphi * kdh);
    energy = (cse_p13_t1_g17250 * deltaphi);
    *energy_accumulate += energy;
    cse_p11_t3_invsqrt17059 = (1.0 / sqrt((1.0000000000000000     + (-(((cosphi) * (cosphi)))))));
    cse_p12_t13_g17072 = (cse_p11_t3_invsqrt17059 * cse_p12_t109_g17168);
    cse_p12_t14_g17073 = (cse_p11_t3_invsqrt17059 * cse_p12_t110_g17169);
    cse_p12_t15_g17074 = (cse_p11_t3_invsqrt17059 * cse_p12_t111_g17170);
    cse_p12_t16_g17075 = (cse_p11_t3_invsqrt17059 * cse_p12_t112_g17171);
    cse_p12_t17_g17076 = (cse_p11_t3_invsqrt17059 * cse_p12_t113_g17172);
    cse_p12_t18_g17077 = (cse_p11_t3_invsqrt17059 * cse_p12_t114_g17173);
    cse_p12_t19_g17078 = (cse_p11_t3_invsqrt17059 * cse_p12_t115_g17174);
    cse_p12_t20_g17079 = (cse_p11_t3_invsqrt17059 * cse_p12_t116_g17175);
    cse_p12_t21_g17080 = (cse_p11_t3_invsqrt17059 * cse_p12_t117_g17176);
    cse_p12_t22_g17081 = (cse_p11_t3_invsqrt17059 * cse_p12_t118_g17177);
    cse_p12_t23_g17082 = (cse_p11_t3_invsqrt17059 * cse_p12_t119_g17178);
    cse_p12_t24_g17083 = (cse_p11_t3_invsqrt17059 * cse_p12_t120_g17179);
    cse_p12_t169_g17228 = (-(cse_p12_t13_g17072));
    cse_p12_t170_g17229 = (-(cse_p12_t14_g17073));
    cse_p12_t171_g17230 = (-(cse_p12_t15_g17074));
    cse_p12_t172_g17231 = (-(cse_p12_t16_g17075));
    cse_p12_t173_g17232 = (-(cse_p12_t17_g17076));
    cse_p12_t174_g17233 = (-(cse_p12_t18_g17077));
    cse_p12_t175_g17234 = (-(cse_p12_t19_g17078));
    cse_p12_t176_g17235 = (-(cse_p12_t20_g17079));
    cse_p12_t177_g17236 = (-(cse_p12_t21_g17080));
    cse_p12_t178_g17237 = (-(cse_p12_t22_g17081));
    cse_p12_t179_g17238 = (-(cse_p12_t23_g17082));
    cse_p12_t180_g17239 = (-(cse_p12_t24_g17083));
    cse_p21_t1_g17274 = (cse_p11_t3_invsqrt17059 * cse_p13_t1_g17250);
    g_x1 = ((-((cse_p12_t120_g17179 * cse_p21_t1_g17274))) + (-((cse_p12_t120_g17179 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x1, 0, g_x1);
    g_y1 = ((-((cse_p12_t118_g17177 * cse_p21_t1_g17274))) + (-((cse_p12_t118_g17177 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x1, 1, g_y1);
    g_z1 = ((-((cse_p12_t119_g17178 * cse_p21_t1_g17274))) + (-((cse_p12_t119_g17178 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x1, 2, g_z1);
    g_x2 = ((-((cse_p12_t111_g17170 * cse_p21_t1_g17274))) + (-((cse_p12_t111_g17170 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x2, 0, g_x2);
    g_y2 = ((-((cse_p12_t109_g17168 * cse_p21_t1_g17274))) + (-((cse_p12_t109_g17168 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x2, 1, g_y2);
    g_z2 = ((-((cse_p12_t110_g17169 * cse_p21_t1_g17274))) + (-((cse_p12_t110_g17169 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x2, 2, g_z2);
    g_x3 = ((-((cse_p12_t114_g17173 * cse_p21_t1_g17274))) + (-((cse_p12_t114_g17173 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x3, 0, g_x3);
    g_y3 = ((-((cse_p12_t113_g17172 * cse_p21_t1_g17274))) + (-((cse_p12_t113_g17172 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x3, 1, g_y3);
    g_z3 = ((-((cse_p12_t112_g17171 * cse_p21_t1_g17274))) + (-((cse_p12_t112_g17171 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x3, 2, g_z3);
    g_x4 = ((-((cse_p12_t117_g17176 * cse_p21_t1_g17274))) + (-((cse_p12_t117_g17176 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x4, 0, g_x4);
    g_y4 = ((-((cse_p12_t115_g17174 * cse_p21_t1_g17274))) + (-((cse_p12_t115_g17174 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x4, 1, g_y4);
    g_z4 = ((-((cse_p12_t116_g17175 * cse_p21_t1_g17274))) + (-((cse_p12_t116_g17175 * cse_p21_t1_g17274))));
    KernelGradientAcc(i3x4, 2, g_z4);
    cse_p12_t1_g17240 = (2.0000000000000000     * kdh);
    h_x1_x1 = (cse_p12_t180_g17239 * cse_p12_t180_g17239 * cse_p12_t1_g17240);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 0, h_x1_x1);
    cse_p15_t1_g17273 = (cse_p12_t178_g17237 * cse_p12_t1_g17240);
    h_x1_y1 = (cse_p12_t180_g17239 * cse_p15_t1_g17273);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 1, h_x1_y1);
    h_x1_z1 = (cse_p12_t179_g17238 * cse_p12_t180_g17239 * cse_p12_t1_g17240);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x1, 2, h_x1_z1);
    cse_p14_t1_g17262 = (cse_p12_t171_g17230 * cse_p12_t1_g17240);
    h_x1_x2 = (cse_p12_t180_g17239 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 0, h_x1_x2);
    cse_p14_t1_g17260 = (cse_p12_t169_g17228 * cse_p12_t1_g17240);
    h_x1_y2 = (cse_p12_t180_g17239 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 1, h_x1_y2);
    cse_p14_t1_g17261 = (cse_p12_t170_g17229 * cse_p12_t1_g17240);
    h_x1_z2 = (cse_p12_t180_g17239 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x2, 2, h_x1_z2);
    cse_p14_t1_g17265 = (cse_p12_t174_g17233 * cse_p12_t1_g17240);
    h_x1_x3 = (cse_p12_t180_g17239 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 0, h_x1_x3);
    cse_p14_t1_g17264 = (cse_p12_t173_g17232 * cse_p12_t1_g17240);
    h_x1_y3 = (cse_p12_t180_g17239 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 1, h_x1_y3);
    cse_p14_t1_g17263 = (cse_p12_t172_g17231 * cse_p12_t1_g17240);
    h_x1_z3 = (cse_p12_t180_g17239 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x3, 2, h_x1_z3);
    cse_p15_t1_g17272 = (cse_p12_t177_g17236 * cse_p12_t1_g17240);
    h_x1_x4 = (cse_p12_t180_g17239 * cse_p15_t1_g17272);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 0, h_x1_x4);
    cse_p14_t1_g17266 = (cse_p12_t175_g17234 * cse_p12_t1_g17240);
    h_x1_y4 = (cse_p12_t180_g17239 * cse_p14_t1_g17266);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 1, h_x1_y4);
    cse_p15_t1_g17271 = (cse_p12_t176_g17235 * cse_p12_t1_g17240);
    h_x1_z4 = (cse_p12_t180_g17239 * cse_p15_t1_g17271);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 0, i3x4, 2, h_x1_z4);
    h_y1_y1 = (cse_p12_t178_g17237 * cse_p15_t1_g17273);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x1, 1, h_y1_y1);
    h_y1_z1 = (cse_p12_t179_g17238 * cse_p15_t1_g17273);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x1, 2, h_y1_z1);
    h_y1_x2 = (cse_p12_t178_g17237 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 0, h_y1_x2);
    h_y1_y2 = (cse_p12_t178_g17237 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 1, h_y1_y2);
    h_y1_z2 = (cse_p12_t178_g17237 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x2, 2, h_y1_z2);
    h_y1_x3 = (cse_p12_t178_g17237 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 0, h_y1_x3);
    h_y1_y3 = (cse_p12_t178_g17237 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 1, h_y1_y3);
    h_y1_z3 = (cse_p12_t178_g17237 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x3, 2, h_y1_z3);
    h_y1_x4 = (cse_p12_t178_g17237 * cse_p15_t1_g17272);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 0, h_y1_x4);
    h_y1_y4 = (cse_p12_t178_g17237 * cse_p14_t1_g17266);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 1, h_y1_y4);
    h_y1_z4 = (cse_p12_t178_g17237 * cse_p15_t1_g17271);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 1, i3x4, 2, h_y1_z4);
    h_z1_z1 = (cse_p12_t179_g17238 * cse_p12_t179_g17238 * cse_p12_t1_g17240);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x1, 2, h_z1_z1);
    h_z1_x2 = (cse_p12_t179_g17238 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 0, h_z1_x2);
    h_z1_y2 = (cse_p12_t179_g17238 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 1, h_z1_y2);
    h_z1_z2 = (cse_p12_t179_g17238 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x2, 2, h_z1_z2);
    h_z1_x3 = (cse_p12_t179_g17238 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 0, h_z1_x3);
    h_z1_y3 = (cse_p12_t179_g17238 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 1, h_z1_y3);
    h_z1_z3 = (cse_p12_t179_g17238 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x3, 2, h_z1_z3);
    h_z1_x4 = (cse_p12_t179_g17238 * cse_p15_t1_g17272);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 0, h_z1_x4);
    h_z1_y4 = (cse_p12_t179_g17238 * cse_p14_t1_g17266);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 1, h_z1_y4);
    h_z1_z4 = (cse_p12_t179_g17238 * cse_p15_t1_g17271);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x1, 2, i3x4, 2, h_z1_z4);
    h_x2_x2 = (cse_p12_t171_g17230 * cse_p14_t1_g17262);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 0, h_x2_x2);
    h_x2_y2 = (cse_p12_t171_g17230 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 1, h_x2_y2);
    h_x2_z2 = (cse_p12_t171_g17230 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x2, 2, h_x2_z2);
    h_x2_x3 = (cse_p12_t174_g17233 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 0, h_x2_x3);
    h_x2_y3 = (cse_p12_t173_g17232 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 1, h_x2_y3);
    h_x2_z3 = (cse_p12_t172_g17231 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x3, 2, h_x2_z3);
    h_x2_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 0, h_x2_x4);
    h_x2_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 1, h_x2_y4);
    h_x2_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17262);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 0, i3x4, 2, h_x2_z4);
    h_y2_y2 = (cse_p12_t169_g17228 * cse_p14_t1_g17260);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x2, 1, h_y2_y2);
    h_y2_z2 = (cse_p12_t170_g17229 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x2, 2, h_y2_z2);
    h_y2_x3 = (cse_p12_t174_g17233 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 0, h_y2_x3);
    h_y2_y3 = (cse_p12_t173_g17232 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 1, h_y2_y3);
    h_y2_z3 = (cse_p12_t172_g17231 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x3, 2, h_y2_z3);
    h_y2_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 0, h_y2_x4);
    h_y2_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 1, h_y2_y4);
    h_y2_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17260);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 1, i3x4, 2, h_y2_z4);
    h_z2_z2 = (cse_p12_t170_g17229 * cse_p14_t1_g17261);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x2, 2, h_z2_z2);
    h_z2_x3 = (cse_p12_t174_g17233 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 0, h_z2_x3);
    h_z2_y3 = (cse_p12_t173_g17232 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 1, h_z2_y3);
    h_z2_z3 = (cse_p12_t172_g17231 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x3, 2, h_z2_z3);
    h_z2_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 0, h_z2_x4);
    h_z2_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 1, h_z2_y4);
    h_z2_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17261);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x2, 2, i3x4, 2, h_z2_z4);
    h_x3_x3 = (cse_p12_t174_g17233 * cse_p14_t1_g17265);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 0, h_x3_x3);
    h_x3_y3 = (cse_p12_t174_g17233 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 1, h_x3_y3);
    h_x3_z3 = (cse_p12_t174_g17233 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x3, 2, h_x3_z3);
    h_x3_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 0, h_x3_x4);
    h_x3_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 1, h_x3_y4);
    h_x3_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17265);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 0, i3x4, 2, h_x3_z4);
    h_y3_y3 = (cse_p12_t173_g17232 * cse_p14_t1_g17264);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x3, 1, h_y3_y3);
    h_y3_z3 = (cse_p12_t173_g17232 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x3, 2, h_y3_z3);
    h_y3_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 0, h_y3_x4);
    h_y3_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 1, h_y3_y4);
    h_y3_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17264);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 1, i3x4, 2, h_y3_z4);
    h_z3_z3 = (cse_p12_t172_g17231 * cse_p14_t1_g17263);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x3, 2, h_z3_z3);
    h_z3_x4 = (cse_p12_t177_g17236 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 0, h_z3_x4);
    h_z3_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 1, h_z3_y4);
    h_z3_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17263);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x3, 2, i3x4, 2, h_z3_z4);
    h_x4_x4 = (cse_p12_t177_g17236 * cse_p15_t1_g17272);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 0, h_x4_x4);
    h_x4_y4 = (cse_p12_t177_g17236 * cse_p14_t1_g17266);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 1, h_x4_y4);
    h_x4_z4 = (cse_p12_t177_g17236 * cse_p15_t1_g17271);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 0, i3x4, 2, h_x4_z4);
    h_y4_y4 = (cse_p12_t175_g17234 * cse_p14_t1_g17266);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 1, i3x4, 1, h_y4_y4);
    h_y4_z4 = (cse_p12_t176_g17235 * cse_p14_t1_g17266);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 1, i3x4, 2, h_y4_z4);
    h_z4_z4 = (cse_p12_t176_g17235 * cse_p15_t1_g17271);
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec,  i3x4, 2, i3x4, 2, h_z4_z4);
  }
}
void hessian_fd(double kdh, double phi0, size_t i3x1, size_t i3x2, size_t i3x3, size_t i3x4, double* position, double* energy_accumulate, double* force, HESSIAN hessian, double* dvec, double* hdvec)
{
  constexpr size_t PositionSize = 12;
  const double h = 1.0e-5;
  const double inv2h = 1.0/(2.0*h);
  const double invh2 = 1.0/((h*h));
  double e0 = 0.0;
  energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e0, 0, 0, 0, 0);
  if (energy_accumulate) { *energy_accumulate += e0; }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 0, d);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 1, d);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x1, 2, d);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 0, d);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 1, d);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x2, 2, d);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 0, d);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 1, d);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x3, 2, d);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 0, d);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 1, d);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double d = (e_plus - e_minus) * inv2h;
    KernelGradientAcc(i3x4, 2, d);
  }
  {
    double saved = position[i3x1 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 0, i3x1, 0, hval);
  }
  {
    double saved = position[i3x1 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 1, i3x1, 1, hval);
  }
  {
    double saved = position[i3x1 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x1 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x1 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 2, hval);
  }
  {
    double saved = position[i3x2 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x2, 0, hval);
  }
  {
    double saved = position[i3x2 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x2, 1, hval);
  }
  {
    double saved = position[i3x2 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x2 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x2 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 2, hval);
  }
  {
    double saved = position[i3x3 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x3, 0, hval);
  }
  {
    double saved = position[i3x3 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x3, 1, hval);
  }
  {
    double saved = position[i3x3 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x3 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x3 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 2, hval);
  }
  {
    double saved = position[i3x4 + 0];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 0] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 0] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x4, 0, hval);
  }
  {
    double saved = position[i3x4 + 1];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 1] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 1] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x4, 1, hval);
  }
  {
    double saved = position[i3x4 + 2];
    double e_plus = 0.0;
    double e_minus = 0.0;
    position[i3x4 + 2] = saved + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_plus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_minus, 0, 0, 0, 0);
    position[i3x4 + 2] = saved;
    double hval = (e_plus + e_minus - (2.0*e0)) * invh2;
    KernelHessDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 2, hval);
  }
  {
    double saved_i = position[i3x1 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x1 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x1 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x1 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x1, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x2 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x2 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x2, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 0];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 0] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 0, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 1];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 1] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 1, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x3 + 2];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x3 + 2] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x3, 2, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 0];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 0] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 0, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 1];
    double saved_j = position[i3x4 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 1] = saved_i + h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i - h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_i; position[i3x4 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 1, i3x4, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x1 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x1 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x1 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x1 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x1, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x2 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x2 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x2 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x2 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x2, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 1, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x3 + 2];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x3 + 2] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x3 + 2] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x3 + 2] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x3, 2, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x4 + 0];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x4 + 0] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 0] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x4 + 0] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 0, hval);
  }
  {
    double saved_i = position[i3x4 + 2];
    double saved_j = position[i3x4 + 1];
    double e_pp = 0.0;
    double e_pm = 0.0;
    double e_mp = 0.0;
    double e_mm = 0.0;
    position[i3x4 + 2] = saved_i + h; position[i3x4 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pp, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_pm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i - h; position[i3x4 + 1] = saved_j + h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mp, 0, 0, 0, 0);
    position[i3x4 + 1] = saved_j - h;
    energy(kdh, phi0, i3x1, i3x2, i3x3, i3x4, position, &e_mm, 0, 0, 0, 0);
    position[i3x4 + 2] = saved_i; position[i3x4 + 1] = saved_j;
    double hval = (e_pp - e_pm - e_mp + e_mm) * (0.25*invh2);
    KernelHessOffDiagAcc( PositionSize, hessian, dvec, hdvec, i3x4, 2, i3x4, 1, hval);
  }
}

};
